<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reporting bounded context implementation | Mojaloop Hub Operations Framework Documentation</title>
    <meta name="description" content="">
    
    <meta name="description" content="Business Operations Framework Documentation">
    <meta name="theme-color" content="#00a3ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/business-operations-framework-docs/assets/css/0.styles.73bef9ff.css" as="style"><link rel="preload" href="/business-operations-framework-docs/assets/js/app.e79f47cd.js" as="script"><link rel="preload" href="/business-operations-framework-docs/assets/js/2.65c7ddde.js" as="script"><link rel="preload" href="/business-operations-framework-docs/assets/js/10.b28ec649.js" as="script"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/11.6dcdbbcd.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/12.82166dd3.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/13.2649a30f.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/14.2190182f.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/15.b1da6c39.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/16.0cdaddde.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/3.94d7a4f5.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/4.08734184.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/5.f18847b0.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/6.19dda1c1.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/7.53fee368.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/8.0180bbd6.js"><link rel="prefetch" href="/business-operations-framework-docs/assets/js/9.b5e52db5.js">
    <link rel="stylesheet" href="/business-operations-framework-docs/assets/css/0.styles.73bef9ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="main-docs-wrapper"><div class="main-content-wrapper"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/business-operations-framework-docs/" class="home-link router-link-active"><img src="/business-operations-framework-docs/mojaloop_logo_med.png" alt="Mojaloop Hub Operations Framework Documentation" class="logo"> <span class="site-name can-hide">Mojaloop Hub Operations Framework Documentation</span></a> <!----> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technical Guide" class="dropdown-title"><span class="title">Technical Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/" class="nav-link router-link-active">
  Technical Introduction
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/SecurityBC.html" class="nav-link">
  RBAC Operational API implementation
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/Microfrontend-JAMStack.html" class="nav-link">
  Micro-frontend - JAMStack design
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/ReportingBC.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Reporting BC Implementation
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/ReportDeveloperGuide.html" class="nav-link">
  Reporting Developer Guide
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/SettlementBC.html" class="nav-link">
  Settlement Ops Implementation
  <!----></a></li></ul></div></div><div class="nav-item"><a href="https://mojaloop.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mojaloop
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://docs.mojaloop.io/mojaloop-business-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Business Documents
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Technical Guide" class="dropdown-title"><span class="title">Technical Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/" class="nav-link router-link-active">
  Technical Introduction
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/SecurityBC.html" class="nav-link">
  RBAC Operational API implementation
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/Microfrontend-JAMStack.html" class="nav-link">
  Micro-frontend - JAMStack design
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/ReportingBC.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Reporting BC Implementation
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/ReportDeveloperGuide.html" class="nav-link">
  Reporting Developer Guide
  <!----></a></li><li class="dropdown-item"><!----> <a href="/business-operations-framework-docs/guide/SettlementBC.html" class="nav-link">
  Settlement Ops Implementation
  <!----></a></li></ul></div></div><div class="nav-item"><a href="https://mojaloop.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mojaloop
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://docs.mojaloop.io/mojaloop-business-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Business Documents
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Technical Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/business-operations-framework-docs/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/business-operations-framework-docs/guide/SecurityBC.html" class="sidebar-link">RBAC Operational API implementation</a></li><li><a href="/business-operations-framework-docs/guide/Microfrontend-JAMStack.html" class="sidebar-link">Micro-frontend - JAMStack design</a></li><li><a href="/business-operations-framework-docs/guide/ReportingBC.html" aria-current="page" class="active sidebar-link">Reporting bounded context implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#design-overview" class="active sidebar-link">Design overview</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#alignment-with-reference-architecture" class="sidebar-link">Alignment with reference architecture</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#use-cases-to-support-the-tracing-of-a-transfer" class="sidebar-link">Use cases to support the tracing of a transfer</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#business-workflow" class="sidebar-link">Business workflow</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#tools-chosen" class="sidebar-link">Tools chosen</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#building-the-event-data-store" class="sidebar-link">Building the event data store</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#transfer-messages-that-are-stored" class="sidebar-link">'Transfer' messages that are stored</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#quote-messages-that-are-stored" class="sidebar-link">'Quote' messages that are stored</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#settlement-messages-that-are-stored" class="sidebar-link">'Settlement' messages that are stored</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#messages-that-currently-remain-unclassified-and-are-filtered-out" class="sidebar-link">Messages that currently remain unclassified and are filtered out</a></li><li class="sidebar-sub-header"><a href="/business-operations-framework-docs/guide/ReportingBC.html#event-processing-service" class="sidebar-link">Event processing service</a></li></ul></li><li><a href="/business-operations-framework-docs/guide/ReportDeveloperGuide.html" class="sidebar-link">Report Developer Guide</a></li><li><a href="/business-operations-framework-docs/guide/SettlementBC.html" class="sidebar-link">Settlement Ops Implementation</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="reporting-bounded-context-implementation"><a href="#reporting-bounded-context-implementation" class="header-anchor">#</a> Reporting bounded context implementation</h1> <p>One of the objectives of this workstream project is to provide the ability to trace a transfer end to end. In order to deliver on this objective, part of the reporting bounded context (BC) is to be built in line with the reference architecture.</p> <h2 id="design-overview"><a href="#design-overview" class="header-anchor">#</a> Design overview</h2> <p>Here is the overall architectural design.<br> <img src="/business-operations-framework-docs/assets/img/Reporting-&amp;-Auditing-Overview.15e5d7de.png" alt="Architecture overview diagram of reporting bounded context"></p> <p>In Mojaloop, all the core services are already pushing events to Kafka on a topic (called ‘topic-event’).</p> <p>There are two fundamental reporting databases:</p> <ol><li><strong>Reporting DB</strong><br>
The reporting database is a relational database that keeps track of the latest state of the Mojaloop objects and makes them available through an efficent query interface. <br> <br>
In the implementation of this workstream effort, a dedicated replica of the central ledger database will be used for reporting. This does not quite fit the architectural model, as a database owned by the reporting bounded context should not have external depencencies. A central ledger replica database is dependent on the schema of the central ledger and therefore has an external dependency.</li></ol> <div class="custom-block warning"><p class="custom-block-title">Technical Debt</p> <p>This should be recognized as <strong>technical debt</strong> that should be paid as more of the reference architecture is built.</p></div> <p>There are two approaches that can be adopted when paying this technical debt:</p> <ul><li>Changing the replica call to a <strong>one-way data sync</strong> function, which would decouple the schemas of the two databases.</li> <li>Rebuilding a new designed <strong>relational database</strong>, which is updated based on subscribed Kafka topics.</li></ul> <p>The best approach will depend on the state of the current Mojaloop version at the time that this debt is paid. <br> <br>
2. <strong>Event DB store</strong><br>
The event DB store is a capture of the event details that can provide a more detailed reporting view of what happened.</p> <p><strong>Limitations of the event store effort in this workstream</strong><br>
This design will be implemented on the current Mojaloop version.</p> <p>Currently, only the data required to provide end-to-end tracing of a transfer will be collected and made available through the reporting API. Extensions to this offering can easily be added by extending the event processor to process new use case messages and store them in the Mongo DB, and then configure the generic graphQL resource query in order to query the new data stores appropriately.</p> <h2 id="alignment-with-reference-architecture"><a href="#alignment-with-reference-architecture" class="header-anchor">#</a> Alignment with reference architecture</h2> <p>Although the bounded context refers to reporting and auditing, this project only begins to tackle the reporting part of that definition. The current design is independent from other bounded contexts, which is in line with the reference architecture.<br>
(There isn’t a complete seperation as the current design is using a replica database as the reporting database. The technical debt and next steps to resolve this are described above.)</p> <p>It is important to consider how this bounded context will change as more of the reference architecture design is implemented.</p> <p>Bounded contexts will - during the reference architecture implmentation - stop storing data in the central ledger databases.</p> <p>There are three approaches that can be adopted to accommodate this change. How the reference architecture is built will determine which is the best approach:</p> <ol><li>Modifying the sync functionality to accomodate the bounded context new data store.</li> <li>Extending the message event processor to capture the required information in the reporting database.</li> <li>Calling newly defined bounded context APIs, to retrieve the required data.</li></ol> <h2 id="use-cases-to-support-the-tracing-of-a-transfer"><a href="#use-cases-to-support-the-tracing-of-a-transfer" class="header-anchor">#</a> Use cases to support the tracing of a transfer</h2> <p>In order to effectively trace a transfer end to end, four use cases were defined.</p> <h3 id="use-case-1-dashboard-view"><a href="#use-case-1-dashboard-view" class="header-anchor">#</a> Use case 1: Dashboard view</h3> <p><strong>As a</strong> Hub Operator Business Operations Specialist,<br> <strong>I want</strong> a high-level dashboard summary of the transfers moving through the hub, which is derived from a date-time range,<br> <strong>So that</strong> I can proactively monitor the health of the ecosystem.</p> <div class="custom-block col-wrapper"><table><thead><tr><th>Data returned</th></tr></thead> <tbody><tr><td>Transfer count</td></tr> <tr><td>Transfer amount total per currency</td></tr> <tr><td>Transfer count per error code</td></tr> <tr><td>Transfer count per Payer DFSP</td></tr> <tr><td>Transfer count per Payee DFSP</td></tr> <tr><td>Transfer amount per currency per Payer DFSP</td></tr> <tr><td>Transfer amount per currency per Payee DFSP</td></tr></tbody></table></div> <h3 id="use-case-2-transfer-list-view"><a href="#use-case-2-transfer-list-view" class="header-anchor">#</a> Use case 2: Transfer list view</h3> <p><strong>As a</strong> Hub Operator Business Operations Specialist,<br> <strong>I want to</strong> view a list of transfers that can be filtered based on one or more of the following:</p> <ul><li><p>Always required (must be provided in every call)</p> <ul><li>Date-time range</li></ul></li> <li><p>Optional filters</p> <ul><li>A specific Payee DFSP</li> <li>A specific Payee ID type</li> <li>A specific Payee</li> <li>A specific Payer DFSP</li> <li>A specific Payer ID type</li> <li>A specific Payer</li> <li>State of the transfer</li> <li>Currency</li></ul></li> <li><p>Nice to have filters (not a strict requirement, but should be provided if the design allows for it)</p> <ul><li>A specific error code</li> <li>Settlement window</li> <li>Settlement batch ID: The unique identifier of the settlement batch in which the transfer was settled. If the transfer has not been settled yet, it is blank.</li> <li>Search string on messages</li></ul></li></ul> <p><strong>So that</strong> I can proactively monitor the health of the ecosystem by having a more detailed view of the transfer data moving through the hub.</p> <div class="custom-block col-wrapper"><table><thead><tr><th>Data returned</th> <th></th></tr></thead> <tbody><tr><td>Transfer ID</td> <td>The unique identifier of the transfer</td></tr> <tr><td>Transfer State</td> <td>Indicates if the transfer has succeeded, is pending, or an error has occurred</td></tr> <tr><td>Transfer Type</td> <td>(For example: P2P)</td></tr> <tr><td>Currency</td> <td>The transfer currency</td></tr> <tr><td>Amount</td> <td>The transfer amount</td></tr> <tr><td>Payer DFSP</td> <td></td></tr> <tr><td>Payer ID Type</td> <td></td></tr> <tr><td>Payer</td> <td></td></tr> <tr><td>Payee DFSP</td> <td></td></tr> <tr><td>Payee ID Type</td> <td></td></tr> <tr><td>Payee</td> <td></td></tr> <tr><td>Settlement Batch ID</td> <td>The unique identifier of the settlement batch in which the transfer was settled.<br> If the transfer has not been settled yet, it is blank.</td></tr> <tr><td>Date Submitted</td> <td>The date and time when the transfer was initiated.</td></tr></tbody></table></div> <h3 id="use-case-3-transfer-detail-view"><a href="#use-case-3-transfer-detail-view" class="header-anchor">#</a> Use case 3: Transfer detail view</h3> <p><strong>As a</strong> Hub Operator Business Operations Specialist,<br> <strong>I want to</strong> trace a specific transfer from its transfer ID,<br> <strong>So that</strong> I can identify:</p> <ul><li>The timing and current state of the transfer</li> <li>Any error information that is associated with that transfer</li> <li>The associated quoting information and timing for that transfer</li> <li>The associated settlement process status and identifiers</li></ul> <div class="custom-block col-wrapper"><table><thead><tr><th>Data returned</th> <th></th></tr></thead> <tbody><tr><td>Transfer ID</td> <td>The unique identifier of the transfer</td></tr> <tr><td>Transfer State</td> <td>Indicates if the transfer has succeeded, is pending, or an error has occurred</td></tr> <tr><td>Transfer Type</td> <td>(For example: P2P)</td></tr> <tr><td>Currency</td> <td>The transfer currency</td></tr> <tr><td>Amount</td> <td>The transfer amount</td></tr> <tr><td>Settlement Batch ID</td> <td>The unique identifier of the settlement batch in which the transfer was settled.<br> If the transfer has not been settled yet, it is blank.</td></tr> <tr><td>Payer</td> <td></td></tr> <tr><td>Payer Details</td> <td>The unique identifier of the Payer (typically, a MSISDN, that is, a mobile number)</td></tr> <tr><td>Payer DFSP</td> <td></td></tr> <tr><td>Payee DFSP</td> <td></td></tr> <tr><td>Payee</td> <td></td></tr> <tr><td>Payee Details</td> <td>The unique identifier of the Payee (typically, a MSISDN, that is, a mobile number)</td></tr> <tr><td>Transfer State</td> <td>Indicates if the transfer has succeeded, is pending, or an error has occurred</td></tr> <tr><td>Date Submitted</td> <td>The date and time when the transfer was initiated</td></tr></tbody></table></div> <h3 id="use-case-4-transfer-message-view"><a href="#use-case-4-transfer-message-view" class="header-anchor">#</a> Use case 4: Transfer message view</h3> <p><strong>As a</strong> Hub Operator Business Operations Specialist,<br> <strong>I want to</strong> view the detailed messages from its transfer ID,<br> <strong>So that</strong> I can investigate any unexpected problem associated with that transfer.</p> <div class="custom-block col-wrapper"><table><thead><tr><th>Data returned</th> <th></th></tr></thead> <tbody><tr><td>Scheme Transfer ID</td> <td></td></tr> <tr><td>TransferID</td> <td></td></tr> <tr><td>QuoteID</td> <td></td></tr> <tr><td>Home Transfer ID</td> <td></td></tr> <tr><td>Payer and Payee Information</td> <td>Id Type, Id Value, Display Name, First Name, Middle Name,<br> Last Name, Date of birth, Mechant classification code,<br> FSP Id, Extension List</td></tr> <tr><td>Party Lookup Response</td> <td></td></tr> <tr><td>Quote Request</td> <td></td></tr> <tr><td>Quote Response</td> <td></td></tr> <tr><td>Transfer Prepare</td> <td></td></tr> <tr><td>Transfer Fulfill</td> <td></td></tr> <tr><td>Error message/s</td> <td></td></tr></tbody></table></div> <h2 id="business-workflow"><a href="#business-workflow" class="header-anchor">#</a> Business workflow</h2> <p>Here is a business workflow that describes how the use cases are called.<br> <img src="/business-operations-framework-docs/assets/img/BusinessFlowView.ab4f176f.png" alt="Business workFlow"></p> <h2 id="tools-chosen"><a href="#tools-chosen" class="header-anchor">#</a> Tools chosen</h2> <h3 id="event-data-store-mongodb"><a href="#event-data-store-mongodb" class="header-anchor">#</a> Event Data Store: MongoDB</h3> <p>The MongoDB database was chosen because:</p> <ul><li>MongoDB is currently used and deployed in Mojaloop, and is an excepted open-source tool that optionally has standard companies that can provide enterprise support should it be required.</li> <li>MongoDB will meet our requirements for this project.</li> <li>Other tools were considered but were found not to meet all the requirements for an OSS tool in Mojaloop.</li></ul> <h3 id="api-graphql"><a href="#api-graphql" class="header-anchor">#</a> API: GraphQL</h3> <p>In addition to the existing reporting API, a GraphQL API will be deployed too. This new API will have the additional functionality of being able to access the event reporting database as supplementary data or standalone query data.</p> <p>The GraphQL API implementation was added for these reasons:</p> <ul><li>A more natural RBAC modelling implementation</li> <li>Easier to mix data from different sources into a single resource</li> <li>Existing reporting solution’s implementation resulted in very complex SQL statements that required specialist knowledge to build and maintain. Splitting the data into a more natural resource and subsequent SQL statement simplifies both the SQL statement and the useage of that resource.</li> <li>In the team we had an GraphQL expert who knew the best lib and tools to use.</li> <li>A generic implementation was built so that no special GraphQL knowledge would be required to extend the functionality.</li></ul> <p><strong>Additional advantages of using GraphQL</strong></p> <ul><li>Reusable resources/associated RBAC permissions between reports</li> <li>Complex queries are simpler to build because resources are modeled</li> <li>Mixing of data sources in a single query (for example, MySQL with MongoDB)</li> <li>No requirement for nested fetches</li> <li>No requirement for multiple fetches</li> <li>No requirement for API version. API naturally supports backward compatibility between versions.</li> <li>Self-documenting API</li></ul> <p><strong>Introduction of a new technology</strong><br>
The introduction of a new technology into the community does bring some risk and a requirement to learn and maintain a new technology. An attempt to reduce the impact of this has been made by implementing the API using a generic or template approach, minimizing the GraphQL knowledge requirement to implement. A GraphQL query example has additionally be supplied.</p> <p>The current GraphQL implementation is developer-friendly.</p> <p><strong>Reporting REST implementation</strong><br>
There is a REST reporting API implementation that has been donated to the Mojaloop community. It is possible to deploy this functionality alongside the GraphQL API implmentation if it becomes neccessary to do so.</p> <h3 id="graphql-api-generic-resource-implementation-explained"><a href="#graphql-api-generic-resource-implementation-explained" class="header-anchor">#</a> GraphQL API - generic resource implementation explained</h3> <p>At the heart of the implementation of this bounded context is a generic implementation that links a reporting data store and a query to a GraphQL data resource that has its own RBAC authorization. That is, a new customized resource can be added to this API by doing the following:</p> <ol><li>Define the data store type</li> <li>Define the query</li> <li>Define the GraphQL resource names and fields</li> <li>Define the user permission that is linked to this resource</li></ol> <h3 id="graphql-query-examples"><a href="#graphql-query-examples" class="header-anchor">#</a> GraphQL query examples</h3> <p><strong>Query transfers that are filtered on a specific Payer DFSP</strong></p> <div class="language-GraphQL extra-class"><pre class="language-graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">GetTransfers</span> <span class="token punctuation">{</span>
  <span class="token property-query">transfers</span><span class="token punctuation">(</span><span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token attr-name">payer</span><span class="token punctuation">:</span> <span class="token string">&quot;payerfsp&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">transferId</span>
    <span class="token property">createdAt</span>
    <span class="token object">payee</span> <span class="token punctuation">{</span>
      <span class="token property">name</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Query a summary of the transfers</strong></p> <div class="language-GraphQL extra-class"><pre class="language-graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">TransferSumary2021Q1</span> <span class="token punctuation">{</span>
  <span class="token property-query">transferSummary</span><span class="token punctuation">(</span>
    <span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token attr-name">currency</span><span class="token punctuation">:</span> <span class="token description string">&quot;<span class="token language-markdown">USD</span>&quot;</span>
        <span class="token attr-name">startDate</span><span class="token punctuation">:</span> <span class="token description string">&quot;<span class="token language-markdown">2021-01-01</span>&quot;</span>
        <span class="token attr-name">endDate</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-03-31&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token property">count</span>
        <span class="token property">payer</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="building-the-event-data-store"><a href="#building-the-event-data-store" class="header-anchor">#</a> Building the event data store</h2> <p>The purpose the event data store is to provide a persistent storage of events of interest that are easily and efficiently found and queried for reporting.</p> <p>To achieve this with minimal structure changes from the original message, it was decided to process the message into categories and store these categories as additional metadata inside the message, which can be queried later on. Messages that do not fit within these categories are not stored and are therefore filtered out.</p> <p>Here is an example of the metadata that is added to the JSON message:</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;content&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;metadata&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;metadata&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;reporting&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;transactionId&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;quoteId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventType&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Quote&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where <code>&quot;eventType&quot;</code> can be one of the following:</p> <div class="custom-block col-wrapper"><div class="custom-block col-third"></div> <div class="custom-block col-third"><table><thead><tr><th>eventType</th></tr></thead> <tbody><tr><td>Quote</td></tr> <tr><td>Transfer</td></tr> <tr><td>Settlement</td></tr></tbody></table></div></div> <p>The event stream processor will subscribe to the Kafa topic <code>'topic-event'</code>. This message queue contains all the event messages. A sigificant degree of filtering is therefore necessary.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The code delivering this functionality has been structured so that these filters can easily be modified or extended.<br>
The subscribed and classified messages are represented in ‘const’ files so they can easily be added to or amended without detailed knowledge of the code.</p></div> <h3 id="storing-only-audit-messages"><a href="#storing-only-audit-messages" class="header-anchor">#</a> Storing only ‘audit’ messages</h3> <p>Only Kafka messages that are of type <code>'audit'</code> will be considered for saving, that is, only if:</p> <div class="custom-block col-wrapper"><div class="custom-block col-third"></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.event.type</th></tr></thead> <tbody><tr><td>audit</td></tr></tbody></table></div></div> <h2 id="transfer-messages-that-are-stored"><a href="#transfer-messages-that-are-stored" class="header-anchor">#</a> ‘Transfer’ messages that are stored</h2> <p><strong>ml-api-adapter</strong></p> <div class="custom-block col-wrapper"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>ml_transfer_prepare</td></tr> <tr><td>ml_transfer_fulfil</td></tr> <tr><td>ml_transfer_abort</td></tr> <tr><td>ml_transfer_getById</td></tr> <tr><td>ml_notification_event</td></tr></tbody></table></div> <h2 id="quote-messages-that-are-stored"><a href="#quote-messages-that-are-stored" class="header-anchor">#</a> ‘Quote’ messages that are stored</h2> <p><strong>quoting-service</strong></p> <div class="custom-block col-wrapper"><div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>qs_quote_handleQuoteRequest</td></tr> <tr><td>qs_quote_forwardQuoteRequest</td></tr> <tr><td>qs_quote_forwardQuoteRequestResend</td></tr> <tr><td>qs_quote_handleQuoteUpdate</td></tr> <tr><td>qs_quote_forwardQuoteUpdate</td></tr> <tr><td>qs_quote_forwardQuoteUpdateResend</td></tr> <tr><td>qs_quote_handleQuoteError</td></tr> <tr><td>qs_quote_forwardQuoteGet</td></tr> <tr><td>qs_quote_sendErrorCallback</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>qs_bulkquote_forwardBulkQuoteRequest</td></tr> <tr><td>qs_quote_forwardBulkQuoteUpdate</td></tr> <tr><td>qs_quote_forwardBulkQuoteGet</td></tr> <tr><td>qs_quote_forwardBulkQuoteError</td></tr> <tr><td>qs_bulkQuote_sendErrorCallback</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>QuotesErrorByIDPut</td></tr> <tr><td>QuotesByIdGet</td></tr> <tr><td>QuotesByIdPut</td></tr> <tr><td>QuotesPost</td></tr> <tr><td>BulkQuotesErrorByIdPut</td></tr> <tr><td>BulkQuotesByIdGet</td></tr> <tr><td>BulkQuotesByIdPut</td></tr> <tr><td>BulkQuotesPost</td></tr></tbody></table></div></div> <h2 id="settlement-messages-that-are-stored"><a href="#settlement-messages-that-are-stored" class="header-anchor">#</a> ‘Settlement’ messages that are stored</h2> <p><strong>central-settlement</strong></p> <div class="custom-block col-wrapper"><div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>cs_process_transfer_settlement_window</td></tr> <tr><td>cs_close_settlement_window</td></tr> <tr><td>…</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>getSettlementWindowsByParams</td></tr> <tr><td>getSettlementWindowById</td></tr> <tr><td>updateSettlementById</td></tr> <tr><td>getSettlementById</td></tr> <tr><td>createSettlement</td></tr> <tr><td>closeSettlementWindow</td></tr> <tr><td>…</td></tr></tbody></table></div></div> <h2 id="messages-that-currently-remain-unclassified-and-are-filtered-out"><a href="#messages-that-currently-remain-unclassified-and-are-filtered-out" class="header-anchor">#</a> Messages that currently remain unclassified and are filtered out</h2> <p><strong>account-lookup-service (not in PI - included as a reference)</strong></p> <div class="custom-block col-wrapper"><div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>ParticipantsErrorByIDPut</td></tr> <tr><td>ParticipantsByIDPut</td></tr> <tr><td>ParticipantsErrorByTypeAndIDPut</td></tr> <tr><td>ParticipantsErrorBySubIdTypeAndIDPut</td></tr> <tr><td>ParticipantsSubIdByTypeAndIDGet</td></tr> <tr><td>ParticipantsSubIdByTypeAndIDPut</td></tr> <tr><td>ParticipantsSubIdByTypeAndIDPost</td></tr> <tr><td>ParticipantsSubIdByTypeAndIDDelete</td></tr> <tr><td>ParticipantsByTypeAndIDGet</td></tr> <tr><td>ParticipantsByTypeAndIDPut</td></tr> <tr><td>ParticipantsByIDAndTypePost</td></tr> <tr><td>ParticipantsByTypeAndIDDelete</td></tr> <tr><td>ParticipantsPost</td></tr> <tr><td>PartiesByTypeAndIDGet</td></tr> <tr><td>PartiesByTypeAndIDPut</td></tr> <tr><td>PartiesErrorByTypeAndIDPut</td></tr> <tr><td>PartiesBySubIdTypeAndIDGet</td></tr> <tr><td>PartiesSubIdByTypeAndIDPut</td></tr> <tr><td>PartiesErrorBySubIdTypeAndIDPut</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>OraclesGet</td></tr> <tr><td>OraclesPost</td></tr> <tr><td>OraclesByIdPut</td></tr> <tr><td>OraclesByIdDelete</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>postParticipants</td></tr> <tr><td>getPartiesByTypeAndID</td></tr> <tr><td>…</td></tr></tbody></table></div></div> <p><strong>transaction-requests-service (not in PI - included as a reference)</strong></p> <div class="custom-block col-wrapper"><div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>TransactionRequestsErrorByID</td></tr> <tr><td>TransactionRequestsByID</td></tr> <tr><td>TransactionRequestsByIDPut</td></tr> <tr><td>TransactionRequests</td></tr> <tr><td>AuthorizationsIDResponse</td></tr> <tr><td>AuthorizationsIDPutResponse</td></tr> <tr><td>AuthorizationsErrorByID</td></tr></tbody></table></div> <div class="custom-block col-third"><table><thead><tr><th>metadata.trace.service</th></tr></thead> <tbody><tr><td>forwardAuthorizationMessage</td></tr> <tr><td>forwardAuthorizationError</td></tr> <tr><td>…</td></tr></tbody></table></div></div> <h3 id="useful-tools"><a href="#useful-tools" class="header-anchor">#</a> Useful tools</h3> <h4 id="kafka-explorer"><a href="#kafka-explorer" class="header-anchor">#</a> Kafka explorer</h4> <p>The <a href="https://github.com/cloudhut/kowl" target="_blank" rel="noopener noreferrer">‘kowl’<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> software from cloudhut is a useful tool to explore all the Kafka messages in a Mojaloop cluster. We can deploy it in the same namespace as the Mojaloop core services.</p> <p>The custom values file for the OSS deployment can be found in this <a href="https://github.com/mojaloop/deploy-config/tree/deploy/PI15.2/mojaloop/kowl-kafka-ui" target="_blank" rel="noopener noreferrer">repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.<br>
(This is private repository, you may need permission to access this link.)</p> <p><strong>Steps to install</strong></p> <div class="language- extra-class"><pre class="language-text"><code>helm repo add cloudhut https://raw.githubusercontent.com/cloudhut/charts/master/archives
helm repo update
helm install kowl cloudhut/kowl -f values-moja2-kowl-values.yaml
</code></pre></div><p><strong>Web UI</strong><br>
Open the URL configured in the <code>ingress</code> section in the <code>values</code> file.</p> <p><strong>Additional customization</strong><br>
For information on how to add further customization, see the <a href="https://github.com/cloudhut/kowl/blob/master/docs/config/kowl.yaml" target="_blank" rel="noopener noreferrer">reference configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> provided by cloudhut.</p> <h4 id="ttk-golden-path"><a href="#ttk-golden-path" class="header-anchor">#</a> TTK golden path</h4> <p>The TTK golden path test cases have been designed to explore all the test outcomes possible when sending transfers. This is therefore an important tool that can be used to test that the functionality caters for all eventualities. That is, we can use the in-built TTK to execute different test-cases such as P2P happy path, negative scenarios, settlement-related use cases, and so on.</p> <h2 id="event-processing-service"><a href="#event-processing-service" class="header-anchor">#</a> Event processing service</h2> <p>The event processing service is responsible for subscribing to Kafka topics and filtering through the events by event type. The event type further breaks down into several parts depending on which service the events were produced from. The filtered events will then be processed depending on the context of the event structure, and reporting metadata will be created.</p> <p>Example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;content&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;metadata&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;metadata&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;reporting&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;transactionId&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;quoteId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventType&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Quote&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>eventType</th> <th>Event origin</th></tr></thead> <tbody><tr><td>Quote</td> <td>quoting-service</td></tr> <tr><td>Transfer</td> <td>ml-api-adapter</td></tr> <tr><td>Settlement</td> <td>central-settlement</td></tr></tbody></table> <p>The event processing service subscribes to the Kafka event stream to build an event transfer related store that is queryable through the operational API. This is in line with the reference architecture.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/1/2021, 4:02:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/business-operations-framework-docs/guide/Microfrontend-JAMStack.html" class="prev">
        Micro-frontend - JAMStack design
      </a></span> <span class="next"><a href="/business-operations-framework-docs/guide/ReportDeveloperGuide.html">
        Report Developer Guide
      </a>
      →
    </span></p></div> </main> <!----></div></div> <!----></div><div class="global-ui"><!----></div></div>
    
    <script src="/business-operations-framework-docs/assets/js/app.e79f47cd.js" defer></script><script src="/business-operations-framework-docs/assets/js/2.65c7ddde.js" defer></script><script src="/business-operations-framework-docs/assets/js/10.b28ec649.js" defer></script>
  </body>
</html>
