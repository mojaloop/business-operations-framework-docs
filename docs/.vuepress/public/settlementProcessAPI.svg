<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="7461px" preserveAspectRatio="none" style="width:3577px;height:7461px;" version="1.1" viewBox="0 0 3577 7461" width="3577px" zoomAndPan="magnify"><defs><filter height="300%" id="fqrjcvdp0dyl4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="209" x="1679.75" y="34.9141">Settlement Process</text><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="1079.875"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="1215.625"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2027.5" y="1407.375"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="3760.9375"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2027.5" y="4104.625"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2027.5" y="4500.3125"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="402.25" style="stroke: #000000; stroke-width: 2.0;" width="1415.5" x="2017.5" y="5408.8125"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="151.9375" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="5463.1875"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="432.4375" style="stroke: #000000; stroke-width: 2.0;" width="1618" x="1521" y="5825.0625"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="5879.4375"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="641.5625" style="stroke: #000000; stroke-width: 2.0;" width="1628" x="1511" y="6271.5"/><rect fill="#FFFFFF" filter="url(#fqrjcvdp0dyl4)" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1521" y="6325.875"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="470" x2="470" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="736" x2="736" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1032" x2="1032" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1686" x2="1686" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2122.5" x2="2122.5" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2657.5" x2="2657.5" y1="144.375" y2="7360.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3061" x2="3061" y1="144.375" y2="7360.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="313" y="139.1016">Business Hub Operator User</text><ellipse cx="470.5" cy="57.1875" fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M470.5,65.1875 L470.5,92.1875 M457.5,73.1875 L483.5,73.1875 M470.5,92.1875 L457.5,107.1875 M470.5,92.1875 L483.5,107.1875 " fill="none" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="313" y="7384.4141">Business Hub Operator User</text><ellipse cx="470.5" cy="7399.6875" fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M470.5,7407.6875 L470.5,7434.6875 M457.5,7415.6875 L483.5,7415.6875 M470.5,7434.6875 L457.5,7449.6875 M470.5,7434.6875 L483.5,7449.6875 " fill="none" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 2.0;"/><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="638" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="645" y="127.1016">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="638" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="645" y="7391.4141">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="946" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="953" y="127.1016">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="946" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="953" y="7391.4141">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1585" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1592" y="127.1016">Experience Layer</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1585" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1592" y="7391.4141">Experience Layer</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2037.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2044.5" y="127.1016">Process Layer</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2037.5" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2044.5" y="7391.4141">Process Layer</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2590.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2597.5" y="127.1016">Report API</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2590.5" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2597.5" y="7391.4141">Report API</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3004" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3011" y="127.1016">Mojaloop</text><rect fill="#F8F8F8" filter="url(#fqrjcvdp0dyl4)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3004" y="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3011" y="7391.4141">Mojaloop</text><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3562.5" x="3" y="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="182.4688" y2="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="185.4688" y2="185.4688"/><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="329" x="1619.75" y="164.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308" x="1625.75" y="193.2891">Close a settlement window</text><polygon fill="#383838" points="1020.5,244.75,1030.5,248.75,1020.5,252.75,1024.5,248.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="248.75" y2="248.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="477.5" y="241.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="494.5" y="241.4766">User clicks close Settlement Window</text><polygon fill="#383838" points="1674.5,293.9375,1684.5,297.9375,1674.5,301.9375,1678.5,297.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1680.5" y1="297.9375" y2="297.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1039.5" y="290.6641">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="1056.5" y="290.6641">Close Settlement Window</text><path d="M883,261.75 L883,301.75 L1023,301.75 L1023,271.75 L1013,261.75 L883,261.75 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,261.75 L1013,271.75 L1023,271.75 L1013,261.75 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="119" x="889" y="291.6641">windows Id</text><polygon fill="#383838" points="3049.5,373.3125,3059.5,377.3125,3049.5,381.3125,3053.5,377.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="3055.5" y1="377.3125" y2="377.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1693.5" y="354.9453">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="223" x="1710.5" y="339.8516">Add user information</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="534" x="1717.5" y="370.0391">POST: /settlementWindows{SettlementWindowId}</text><polygon fill="#383838" points="1043.5,417.5,1033.5,421.5,1043.5,425.5,1039.5,421.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1685.5" y1="421.5" y2="421.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1049.5" y="414.2266">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="108" x="1066.5" y="414.2266">Update UI</text><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3562.5" x="3" y="457.5938"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="457.5938" y2="457.5938"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="460.5938" y2="460.5938"/><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="228" x="1670.25" y="439.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="1676.25" y="468.4141">Initiate Settlement</text><polygon fill="#383838" points="1020.5,539.9688,1030.5,543.9688,1020.5,547.9688,1024.5,543.9688" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="543.9688" y2="543.9688"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="477.5" y="536.6953">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="521" x="494.5" y="536.6953">Initiate Settlement for these windows &amp; Currency</text><path d="M8,492.6875 L8,562.6875 L462,562.6875 L462,502.6875 L452,492.6875 L8,492.6875 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M452,492.6875 L452,502.6875 L462,502.6875 L452,492.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="325" x="14" y="522.6016">List of Settlement windows Ids</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="433" x="14" y="552.7891">[Optional] Currency or Settlement Model</text><polygon fill="#383838" points="1674.5,699.8125,1684.5,703.8125,1674.5,707.8125,1678.5,703.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1680.5" y1="703.8125" y2="703.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1039.5" y="696.5391">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="271" x="1056.5" y="696.5391">POST: /initiateSettlement</text><path d="M542,577.0625 L542,798.0625 L1023,798.0625 L1023,587.0625 L1013,577.0625 L542,577.0625 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,577.0625 L1013,587.0625 L1023,587.0625 L1013,577.0625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="257" x="548" y="606.9766">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="576" y="637.1641">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="64" x="590" y="667.3516">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="576" y="697.5391">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="555" y="727.7266">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="555" y="757.9141">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="555" y="788.1016">}</text><polygon fill="#383838" points="2110.5,950.2188,2120.5,954.2188,2110.5,958.2188,2114.5,954.2188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="2116.5" y1="954.2188" y2="954.2188"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1693.5" y="946.9453">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="271" x="1710.5" y="946.9453">POST: /initiateSettlement</text><path d="M1196,812.375 L1196,1063.375 L1677,1063.375 L1677,822.375 L1667,812.375 L1196,812.375 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1667,812.375 L1667,822.375 L1677,822.375 L1667,812.375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="257" x="1202" y="842.2891">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1230" y="872.4766">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="64" x="1244" y="902.6641">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="1230" y="932.8516">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="1209" y="963.0391">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="1209" y="993.2266">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="417" x="1209" y="1023.4141">"user": "hub operators name" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1209" y="1053.6016">}</text><path d="M2027.5,1079.875 L2124.5,1079.875 L2124.5,1101.875 L2114.5,1111.875 L2027.5,1111.875 L2027.5,1079.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="1079.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2042.5" y="1105.7891">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="339" x="2139.5" y="1106.7891">[For each settlement window]</text><polygon fill="#383838" points="3049.5,1189.625,3059.5,1193.625,3049.5,1197.625,3053.5,1193.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="1193.625" y2="1193.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="2129.5" y="1171.2578">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="835" x="2146.5" y="1156.1641">Confirm that the settlement window is closed and wait retry with timeout if not.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="520" x="2146.5" y="1186.3516">GET central-settlements/settlementWindows/{id}</text><path d="M2027.5,1215.625 L2410.5,1215.625 L2410.5,1237.625 L2400.5,1247.625 L2027.5,1247.625 L2027.5,1215.625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="1215.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="338" x="2042.5" y="1241.5391">determine settlement Model/s</text><polygon fill="#383838" points="3049.5,1280,3059.5,1284,3049.5,1288,3053.5,1284" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="1284" y2="1284"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="2129.5" y="1276.7266">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="898" x="2146.5" y="1276.7266">Load currencies for windows using GET central-settlements/settlementWindows/{id}</text><polygon fill="#383838" points="3049.5,1324.1875,3059.5,1328.1875,3049.5,1332.1875,3053.5,1328.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="1328.1875" y2="1328.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="1320.9141">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2159.5" y="1320.9141">Load settlement models using GET central-ledger/settlementModels</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="1372.375" y2="1372.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="1372.375" y2="1385.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="1385.375" y2="1385.375"/><polygon fill="#383838" points="2133.5,1381.375,2123.5,1385.375,2133.5,1389.375,2129.5,1385.375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="1365.1016">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="483" x="2159.5" y="1365.1016">Determine minimum list of settlement models</text><path d="M2027.5,1407.375 L2124.5,1407.375 L2124.5,1429.375 L2114.5,1439.375 L2027.5,1439.375 L2027.5,1407.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2027.5" y="1407.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2042.5" y="1433.2891">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="2139.5" y="1434.2891">[for settlement models]</text><polygon fill="#383838" points="3049.5,1547.3125,3059.5,1551.3125,3049.5,1555.3125,3053.5,1551.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="1551.3125" y2="1551.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="1513.8516">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="190" x="2159.5" y="1483.6641">Create settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="1513.8516"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="436" x="2166.5" y="1513.8516">POST: central-settlements/settlements</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2609.5" y="1513.8516"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="451" x="2159.5" y="1544.0391">{settlementModel, settlementWindowIds[]}</text><polygon fill="#383838" points="3049.5,1651.875,3059.5,1655.875,3049.5,1659.875,3053.5,1655.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="1655.875" y2="1655.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="1618.4141">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="422" x="2159.5" y="1588.2266">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="423" x="2166.5" y="1618.4141">state to PS_TRANSFERS_RECORDED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="1648.6016"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="466" x="2166.5" y="1648.6016">PUT: central-settlements/settlements/{id}</text><path d="M3066,1668.875 L3066,1738.875 L3398,1738.875 L3398,1678.875 L3388,1668.875 L3066,1668.875 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3388,1668.875 L3388,1678.875 L3398,1678.875 L3388,1668.875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="3072" y="1698.7891">Net credit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3189" y="1698.7891">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3072" y="1728.9766">position ledgers are adjusted</text><polygon fill="#383838" points="1697.5,2018.8438,1687.5,2022.8438,1697.5,2026.8438,1693.5,2022.8438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1691.5" x2="2121.5" y1="2022.8438" y2="2022.8438"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1703.5" y="2015.5703">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="382" x="1733.5" y="2015.5703">Return reponse, success HTTP:200</text><path d="M2127,1760.25 L2127,2253.25 L2620,2253.25 L2620,1770.25 L2610,1760.25 L2127,1760.25 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2610,1760.25 L2610,1770.25 L2620,1770.25 L2610,1760.25 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="1790.1641">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="7" x="2147" y="1820.3516">[</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="444" x="2161" y="1850.5391">"SettlementModel":"defered-net" #(string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="300" x="2161" y="1880.7266">"id":null, # optional (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="349" x="2161" y="1910.9141">"state": "state" # optional (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="322" x="2161" y="1941.1016">"errorInformation": { # optional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="159" x="2182" y="1971.2891">"errorCode": 0,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="287" x="2182" y="2001.4766">"errorDescription": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="179" x="2182" y="2031.6641">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="141" x="2196" y="2061.8516">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2210" y="2092.0391">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="154" x="2224" y="2122.2266">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="226" x="2224" y="2152.4141">"value": "string" } ] } }</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="7" x="2154" y="2182.6016">]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="2212.7891">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2140" y="2242.9766"/><polygon fill="#383838" points="1043.5,2294.4375,1033.5,2298.4375,1043.5,2302.4375,1039.5,2298.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1685.5" y1="2298.4375" y2="2298.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="2291.1641">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="349" x="1079.5" y="2291.1641">Update UI with settlement status</text><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3562.5" x="3" y="2334.5313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="2334.5313" y2="2334.5313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="2337.5313" y2="2337.5313"/><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="415" x="1576.75" y="2316.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="1582.75" y="2345.3516">Generate Settlement Matrix Report</text><polygon fill="#383838" points="1020.5,2396.8125,1030.5,2400.8125,1020.5,2404.8125,1024.5,2400.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="2400.8125" y2="2400.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="2393.5391">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="507.5" y="2393.5391">Settlement Initiation Report Download</text><polygon fill="#383838" points="1674.5,2441,1684.5,2445,1674.5,2449,1678.5,2445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1680.5" y1="2445" y2="2445"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="2437.7266">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="100" x="1069.5" y="2437.7266">Add User</text><polygon fill="#383838" points="2645.5,2485.1875,2655.5,2489.1875,2645.5,2493.1875,2649.5,2489.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="2651.5" y1="2489.1875" y2="2489.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1693.5" y="2481.9141">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="1723.5" y="2481.9141">Settlement Initiation Report Download</text><polygon fill="#383838" points="1043.5,2529.375,1033.5,2533.375,1043.5,2537.375,1039.5,2533.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="2656.5" y1="2533.375" y2="2533.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="2526.1016">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="1079.5" y="2526.1016">report is downloaded</text><polygon fill="#383838" points="481.5,2573.5625,471.5,2577.5625,481.5,2581.5625,477.5,2577.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="1031.5" y1="2577.5625" y2="2577.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="2570.2891">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="517.5" y="2570.2891">report is downloaded</text><polygon fill="#383838" points="724,2668.0313,734,2672.0313,724,2676.0313,728,2672.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="730" y1="2672.0313" y2="2672.0313"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="2664.7578">21</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="514.5" y="2664.7578"/><path d="M157,2590.5625 L157,2720.5625 L461,2720.5625 L461,2600.5625 L451,2590.5625 L157,2590.5625 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M451,2590.5625 L451,2600.5625 L461,2600.5625 L451,2590.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="176" x="163" y="2620.4766">Report is sent to</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="163" y="2650.6641">settlement bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="87" x="352" y="2650.6641">to begin</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="254" x="163" y="2680.8516">the settlement transfers</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="222" x="163" y="2711.0391">between participants</text><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3562.5" x="3" y="2758.4063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="2758.4063" y2="2758.4063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3565.5" y1="2761.4063" y2="2761.4063"/><rect fill="#EEEEEE" filter="url(#fqrjcvdp0dyl4)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="240" x="1664.25" y="2740.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="1670.25" y="2769.2266">Finalise Settlement</text><polygon fill="#383838" points="481.5,2976.625,471.5,2980.625,481.5,2984.625,477.5,2980.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="735" y1="2980.625" y2="2980.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="2973.3516">22</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="524.5" y="2973.3516"/><path d="M741,2793.5 L741,3135.5 L1344,3135.5 L1344,2803.5 L1334,2793.5 L741,2793.5 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1334,2793.5 L1334,2803.5 L1344,2803.5 L1334,2793.5 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="747" y="2823.4141">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="795" y="2823.4141">Settlement Bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="243" x="989" y="2823.4141">has completed making</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="330" x="747" y="2853.6016">transfers between participants.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="747" y="2883.7891">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="795" y="2883.7891">finalisation report</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="216" x="1006" y="2883.7891">that is recieved from</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="575" x="747" y="2913.9766">the Settlement Bank, includes the settlement account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="570" x="747" y="2944.1641">balances after all the transfers have been processed.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="754" y="2974.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="525" x="747" y="3004.5391">It is possible that these account balances are not</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="431" x="747" y="3034.7266">as expected. This would indicate that an</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="1185" y="3034.7266">additional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1307" y="3034.7266"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="747" y="3064.9141">funds in / funds out</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="318" x="981" y="3064.9141">has occured in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="501" x="747" y="3095.1016">accounts that has not yet been captured in the</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="314" x="747" y="3125.2891">Mojaloop Settlement ledgers.</text><polygon fill="#383838" points="1020.5,3176.75,1030.5,3180.75,1020.5,3184.75,1024.5,3180.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="3180.75" y2="3180.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="3173.4766">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="507.5" y="3173.4766">Validate finalisation file</text><polygon fill="#383838" points="1674.5,3220.9375,1684.5,3224.9375,1674.5,3228.9375,1678.5,3224.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1680.5" y1="3224.9375" y2="3224.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="3217.6641">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="1069.5" y="3217.6641">Validate finalisation file</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="1728.5" y1="3494.0313" y2="3494.0313"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1728.5" x2="1728.5" y1="3494.0313" y2="3507.0313"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1687.5" x2="1728.5" y1="3507.0313" y2="3507.0313"/><polygon fill="#383838" points="1697.5,3503.0313,1687.5,3507.0313,1697.5,3511.0313,1693.5,3507.0313" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1693.5" y="3471.6641">25</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="267" x="1723.5" y="3456.5703">Fatal: Validate file format</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="280" x="1730.5" y="3486.7578">Load file into JSON object</text><path d="M790,3237.9375 L790,3699.9375 L1677,3699.9375 L1677,3247.9375 L1667,3237.9375 L790,3237.9375 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1667,3237.9375 L1667,3247.9375 L1677,3247.9375 L1667,3237.9375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="796" y="3267.8516">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="761" x="810" y="3298.0391">"finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="540" x="810" y="3328.2266">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="170" x="810" y="3358.4141">"participants" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="824" y="3388.6016">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="597" x="838" y="3418.7891">"name": "payerfsp",# mojaloop participant name (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="425" x="838" y="3448.9766">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="779" x="838" y="3479.1641">"settlementAccountId": 1, # settlement account id for participant (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="824" x="838" y="3509.3516">"externalBalance": 10000, # external balance of settlement account (number)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="273" x="838" y="3539.5391">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="243" x="880" y="3569.7266">"amount": 0, # number</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="560" x="880" y="3599.9141">"currency": "XXX" # currency string (CurrencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="866" y="3630.1016">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="824" y="3660.2891">}  ] # all participants that are involved in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="796" y="3690.4766">}</text><polygon fill="#383838" points="2110.5,3741.9375,2120.5,3745.9375,2110.5,3749.9375,2114.5,3745.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="2116.5" y1="3745.9375" y2="3745.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1693.5" y="3738.6641">26</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1723.5" y="3738.6641">Validate finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="65" x="1957.5" y="3738.6641">POST</text><path d="M2027.5,3760.9375 L2304.5,3760.9375 L2304.5,3782.9375 L2294.5,3792.9375 L2027.5,3792.9375 L2027.5,3760.9375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="3760.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="232" x="2042.5" y="3786.8516">load settlement data</text><polygon fill="#383838" points="3049.5,3855.5,3059.5,3859.5,3049.5,3863.5,3053.5,3859.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="3859.5" y2="3859.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="3837.1328">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="284" x="2159.5" y="3822.0391">Get settlement information</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="461" x="2159.5" y="3852.2266">GET central-settlements/settlements/{id}</text><polygon fill="#383838" points="3049.5,3929.875,3059.5,3933.875,3049.5,3937.875,3053.5,3933.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="3933.875" y2="3933.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="3911.5078">28</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="202" x="2159.5" y="3896.4141">Get all participants</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="3926.6016"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="358" x="2166.5" y="3926.6016">GET central-ledger/participants</text><polygon fill="#383838" points="3049.5,4004.25,3059.5,4008.25,3049.5,4012.25,3053.5,4008.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="4008.25" y2="4008.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="3985.8828">29</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="264" x="2159.5" y="3970.7891">Get all participants limits</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="4000.9766"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="428" x="2166.5" y="4000.9766">GET central-ledger/participants/limits</text><polygon fill="#383838" points="3049.5,4078.625,3059.5,4082.625,3049.5,4086.625,3053.5,4082.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="4082.625" y2="4082.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4060.2578">30</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="439" x="2159.5" y="4045.1641">For each participant get account balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="4075.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2166.5" y="4075.3516">GET central-ledger/participants/{name}/accounts</text><path d="M2027.5,4104.625 L2284.5,4104.625 L2284.5,4126.625 L2274.5,4136.625 L2027.5,4136.625 L2027.5,4104.625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2027.5" y="4104.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="2042.5" y="4130.5391">Process validation</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4233.375" y2="4233.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4233.375" y2="4246.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4246.375" y2="4246.375"/><polygon fill="#383838" points="2133.5,4242.375,2123.5,4246.375,2133.5,4250.375,2129.5,4246.375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4195.9141">31</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="389" x="2159.5" y="4165.7266">Fatal: Validate Participants and their</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="319" x="2166.5" y="4195.9141">accounts ids are valid, match,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="491" x="2159.5" y="4226.1016">and are the correct type, and correct currency</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4290.5625" y2="4290.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4290.5625" y2="4303.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4303.5625" y2="4303.5625"/><polygon fill="#383838" points="2133.5,4299.5625,2123.5,4303.5625,2133.5,4307.5625,2129.5,4303.5625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4283.2891">32</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="459" x="2159.5" y="4283.2891">Fatal: Validate Settlement Id non-matching</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4377.9375" y2="4377.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4377.9375" y2="4390.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4390.9375" y2="4390.9375"/><polygon fill="#383838" points="2133.5,4386.9375,2123.5,4390.9375,2133.5,4394.9375,2129.5,4390.9375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4355.5703">33</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2159.5" y="4340.4766">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="212" x="2159.5" y="4370.6641">transfer sum is zero</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4465.3125" y2="4465.3125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4465.3125" y2="4478.3125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4478.3125" y2="4478.3125"/><polygon fill="#383838" points="2133.5,4474.3125,2123.5,4478.3125,2133.5,4482.3125,2129.5,4478.3125" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4442.9453">34</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2159.5" y="4427.8516">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="339" x="2159.5" y="4458.0391">matches net settlement amount</text><path d="M2027.5,4500.3125 L2497.5,4500.3125 L2497.5,4522.3125 L2487.5,4532.3125 L2027.5,4532.3125 L2027.5,4500.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2027.5" y="4500.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="425" x="2042.5" y="4526.2266">Calculate Adjustments and Warnings</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4629.0625" y2="4629.0625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4629.0625" y2="4642.0625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4642.0625" y2="4642.0625"/><polygon fill="#383838" points="2133.5,4638.0625,2123.5,4642.0625,2133.5,4646.0625,2129.5,4642.0625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4591.6016">35</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2159.5" y="4561.4141">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="213" x="2159.5" y="4591.6016">balance is expected</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="2166.5" y="4621.7891">Return warnings if there are discrepencies</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="2164.5" y1="4716.4375" y2="4716.4375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2164.5" x2="2164.5" y1="4716.4375" y2="4729.4375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2123.5" x2="2164.5" y1="4729.4375" y2="4729.4375"/><polygon fill="#383838" points="2133.5,4725.4375,2123.5,4729.4375,2133.5,4733.4375,2129.5,4729.4375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="4694.0703">36</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2159.5" y="4678.9766">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="2159.5" y="4709.1641">balance is zero or positive</text><polygon fill="#383838" points="1697.5,4857.0938,1687.5,4861.0938,1697.5,4865.0938,1693.5,4861.0938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1691.5" x2="2121.5" y1="4861.0938" y2="4861.0938"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1703.5" y="4853.8203">37</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="1733.5" y="4853.8203">Return finalisation validation results</text><path d="M2127,4749.4375 L2127,4940.4375 L3008,4940.4375 L3008,4759.4375 L2998,4749.4375 L2127,4749.4375 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2998,4749.4375 L2998,4759.4375 L3008,4759.4375 L2998,4749.4375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="4779.3516">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="539" x="2147" y="4809.5391">"finalisationId": "GUIDv4", # Guid version 4 (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="511" x="2147" y="4839.7266">"valid":true, # (boolean) true if none failure error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="818" x="2147" y="4869.9141">"errors": [{"type": "string", "message": "description", "errorInformation": {...}}],</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="846" x="2147" y="4900.1016">"warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="4930.2891">}</text><polygon fill="#383838" points="1043.5,4981.75,1033.5,4985.75,1043.5,4989.75,1039.5,4985.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1685.5" y1="4985.75" y2="4985.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="4978.4766">38</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="328" x="1079.5" y="4978.4766">Show validation results to user</text><polygon fill="#383838" points="481.5,5025.9375,471.5,5029.9375,481.5,5033.9375,477.5,5029.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="1031.5" y1="5029.9375" y2="5029.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="5022.6641">39</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="524.5" y="5022.6641"/><polygon fill="#383838" points="1020.5,5070.125,1030.5,5074.125,1020.5,5078.125,1024.5,5074.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="5074.125" y2="5074.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="5066.8516">40</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="446" x="507.5" y="5066.8516">User confirms proceeding with finalisation</text><polygon fill="#383838" points="1674.5,5164.5938,1684.5,5168.5938,1674.5,5172.5938,1678.5,5168.5938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1680.5" y1="5168.5938" y2="5168.5938"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="5161.3203">41</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="1069.5" y="5161.3203">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="47" x="1310.5" y="5161.3203">PUT</text><path d="M530,5087.125 L530,5217.125 L1023,5217.125 L1023,5097.125 L1013,5087.125 L530,5087.125 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,5087.125 L1013,5097.125 L1023,5097.125 L1013,5087.125 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="536" y="5117.0391">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="332" x="550" y="5147.2266">finalisationId:"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="458" x="550" y="5177.4141">balanceSettlementOption: true # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="536" y="5207.6016">}</text><polygon fill="#383838" points="2110.5,5324.4375,2120.5,5328.4375,2110.5,5332.4375,2114.5,5328.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1686.5" x2="2116.5" y1="5328.4375" y2="5328.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1693.5" y="5321.1641">42</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="1723.5" y="5321.1641">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="47" x="1964.5" y="5321.1641">PUT</text><path d="M1166,5231.875 L1166,5391.875 L1677,5391.875 L1677,5241.875 L1667,5231.875 L1166,5231.875 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1667,5231.875 L1667,5241.875 L1677,5241.875 L1667,5231.875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1172" y="5261.7891">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="350" x="1186" y="5291.9766">"finalisationId":"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="476" x="1186" y="5322.1641">"balanceSettlementOption":true, # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="303" x="1186" y="5352.3516">"user":"userName" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1172" y="5382.5391">}</text><path d="M2017.5,5408.8125 L2114.5,5408.8125 L2114.5,5430.8125 L2104.5,5440.8125 L2017.5,5440.8125 L2017.5,5408.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="402.25" style="stroke: #000000; stroke-width: 2.0;" width="1415.5" x="2017.5" y="5408.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2032.5" y="5434.7266">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="430" x="2129.5" y="5435.7266">[for each settlement debit participant]</text><path d="M2027.5,5463.1875 L2100.5,5463.1875 L2100.5,5485.1875 L2090.5,5495.1875 L2027.5,5495.1875 L2027.5,5463.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="151.9375" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="5463.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="2042.5" y="5489.1016">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="2115.5" y="5490.1016">[if balanceSettlementOption is true]</text><polygon fill="#383838" points="3049.5,5603.125,3059.5,5607.125,3049.5,5611.125,3053.5,5607.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="5607.125" y2="5607.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="5569.6641">43</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="655" x="2159.5" y="5539.4766">Adjust settlment account according to settlement (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2166.5" y="5569.6641">POST central-ledger/participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2159.5" y="5599.8516">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><polygon fill="#383838" points="3049.5,5714.6875,3059.5,5718.6875,3049.5,5722.6875,3053.5,5718.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="5718.6875" y2="5718.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="5681.2266">44</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2159.5" y="5651.0391">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="790" x="2159.5" y="5681.2266">PUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2166.5" y="5711.4141">PUT /settlements/{sid}/participants/{pid}</text><path d="M3066,5731.6875 L3066,5801.6875 L3419,5801.6875 L3419,5741.6875 L3409,5731.6875 L3066,5731.6875 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3409,5731.6875 L3409,5741.6875 L3419,5741.6875 L3409,5731.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="3072" y="5761.6016">Net debit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3182" y="5761.6016">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3093" y="5791.7891">position ledgers are adjusted</text><path d="M1521,5825.0625 L1618,5825.0625 L1618,5847.0625 L1608,5857.0625 L1521,5857.0625 L1521,5825.0625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="432.4375" style="stroke: #000000; stroke-width: 2.0;" width="1618" x="1521" y="5825.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1536" y="5850.9766">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1633" y="5851.9766">[for each settlement credit participant]</text><path d="M2027.5,5879.4375 L2100.5,5879.4375 L2100.5,5901.4375 L2090.5,5911.4375 L2027.5,5911.4375 L2027.5,5879.4375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2027.5" y="5879.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="2042.5" y="5905.3516">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="2115.5" y="5906.3516">[if balanceSettlementOption is true]</text><polygon fill="#383838" points="3049.5,5989.1875,3059.5,5993.1875,3049.5,5997.1875,3053.5,5993.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="5993.1875" y2="5993.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="5970.8203">45</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="635" x="2159.5" y="5955.7266">Adjust settlment account according to settlement (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2166.5" y="5985.9141">POST /participants/{name}/accounts/{id}</text><path d="M1531,6013.1875 L1531,6143.1875 L2113,6143.1875 L2113,6023.1875 L2103,6013.1875 L1531,6013.1875 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2103,6013.1875 L2103,6023.1875 L2113,6023.1875 L2103,6013.1875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="358" x="1537" y="6043.1016">reason: "Settlement Finanisation"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1537" y="6073.2891">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1551" y="6103.4766">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1565" y="6133.6641">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3049.5,6245.5,3059.5,6249.5,3049.5,6253.5,3053.5,6249.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="6249.5" y2="6249.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="6212.0391">46</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2159.5" y="6181.8516">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="790" x="2159.5" y="6212.0391">PUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2166.5" y="6242.2266">PUT /settlements/{sid}/participants/{pid}</text><path d="M1511,6271.5 L1584,6271.5 L1584,6293.5 L1574,6303.5 L1511,6303.5 L1511,6271.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="641.5625" style="stroke: #000000; stroke-width: 2.0;" width="1628" x="1511" y="6271.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1526" y="6297.4141">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="1599" y="6298.4141">[if balanceSettlementOption is true]</text><path d="M1521,6325.875 L1618,6325.875 L1618,6347.875 L1608,6357.875 L1521,6357.875 L1521,6325.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1521" y="6325.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1536" y="6351.7891">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="592" x="1633" y="6352.7891">[For each participant rebalance Settlement account]</text><polygon fill="#383838" points="3049.5,6435.625,3059.5,6439.625,3049.5,6443.625,3053.5,6439.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="6439.625" y2="6439.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="6417.2578">47</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="196" x="2159.5" y="6402.1641">Get latest balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="6432.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2166.5" y="6432.3516">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="3049.5,6540.1875,3059.5,6544.1875,3049.5,6548.1875,3053.5,6544.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="6544.1875" y2="6544.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="6506.7266">48</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2159.5" y="6476.5391">if &lt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="293" x="2166.5" y="6506.7266">increase balance (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2166.5" y="6536.9141">POST central-ledger/participants/{name}/accounts/{id}</text><polygon fill="#383838" points="3049.5,6674.9375,3059.5,6678.9375,3049.5,6682.9375,3053.5,6678.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="6678.9375" y2="6678.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="6626.3828">49</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2159.5" y="6581.1016">if &gt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="321" x="2166.5" y="6611.2891">decrease balance (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2166.5" y="6641.4766">POST central-ledger/participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2159.5" y="6671.6641">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><path d="M1531,6691.9375 L1531,6821.9375 L2113,6821.9375 L2113,6701.9375 L2103,6691.9375 L1531,6691.9375 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2103,6691.9375 L2103,6701.9375 L2113,6701.9375 L2103,6691.9375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="343" x="1537" y="6721.8516">reason: "Settlement Rebalance"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1537" y="6752.0391">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1551" y="6782.2266">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1565" y="6812.4141">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3049.5,6894.0625,3059.5,6898.0625,3049.5,6902.0625,3053.5,6898.0625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2122.5" x2="3055.5" y1="6898.0625" y2="6898.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2129.5" y="6875.6953">50</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="256" x="2159.5" y="6860.6016">Confirm correct balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2166.5" y="6890.7891"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2166.5" y="6890.7891">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="1697.5,7093.0938,1687.5,7097.0938,1697.5,7101.0938,1693.5,7097.0938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1691.5" x2="2121.5" y1="7097.0938" y2="7097.0938"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1703.5" y="7089.8203">51</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="108" x="1733.5" y="7089.8203">Response</text><path d="M2127,6925.0625 L2127,7236.0625 L3551,7236.0625 L3551,6935.0625 L3541,6925.0625 L2127,6925.0625 " fill="#ECECEC" filter="url(#fqrjcvdp0dyl4)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3541,6925.0625 L3541,6935.0625 L3551,6935.0625 L3541,6925.0625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="6954.9766">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="169" x="2147" y="6985.1641">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="170" x="2147" y="7015.3516">"participants" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2147" y="7045.5391">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="597" x="2161" y="7075.7266">"name": "payerfsp",# mojaloop participant name (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="425" x="2161" y="7105.9141">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="779" x="2161" y="7136.1016">"settlementAccountId": 1, # settlement account id for participant (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="1375" x="2161" y="7166.2891">"errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="15" x="2147" y="7196.4766">}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2133" y="7226.6641">}</text><polygon fill="#383838" points="1043.5,7338.5,1033.5,7342.5,1043.5,7346.5,1039.5,7342.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1685.5" y1="7342.5" y2="7342.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="7305.0391">52</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="1079.5" y="7274.8516">Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="86" x="1086.5" y="7305.0391">Process</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="593" x="1086.5" y="7335.2266">Completed (Update settlement Status or display errors)</text><!--MD5=[7deca1268209a3ad4a94a488d012c360]
@startuml settlementProcessAPI
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja

== Close a settlement window ==
bu->ui: User clicks close Settlement Window
ui->el: Close Settlement Window
note left
windows Id
end note
el->moja: Add user information\n POST: /settlementWindows{SettlementWindowId}
el- ->ui: Update UI
== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency or Settlement Model
end note

ui->el: POST: /initiateSettlement 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 }
end note
el->pl: POST: /initiateSettlement 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 "user": "hub operators name" # (string) 
 }
end note
loop For each settlement window
pl->moja: Confirm that the settlement window is closed and wait retry with timeout if not.  \nGET central-settlements/settlementWindows/{id}
end
group determine settlement Model/s 
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlement models using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlement models
end

loop for settlement models
pl->moja: Create settlement \n **POST: central-settlements/settlements** \n{settlementModel, settlementWindowIds[]}
pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: central-settlements/settlements/{id}**
note right moja
**Net credit** participant 
position ledgers are adjusted
end note
end loop
pl- ->el: Return reponse, success HTTP:200
note right
 {
   [
     "SettlementModel":"defered-net" #(string)
     "id":null, # optional (integer)
     "state": "state" # optional (string)
     "errorInformation": { # optional
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" } ] } }
    ]
 }

end note
el- ->ui: Update UI with settlement status

== Generate Settlement Matrix Report ==
bu->ui: Settlement Initiation Report Download
ui->el: Add User
el->report: Settlement Initiation Report Download
report- ->ui: report is downloaded
ui- ->bu:report is downloaded
bu->sbank:
note left
Report is sent to 
**settlement bank** to begin 
the settlement transfers 
between participants
end note

== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: Validate finalisation file
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
group Calculate Adjustments and Warnings
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
end 
pl- -> el: Return finalisation validation results
note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":true, # (boolean) true if none failure error
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}],
    "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
end note
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** PUT 
note left
{
  finalisationId:"GUIDv4", (string)
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** PUT 
note left
{
  "finalisationId":"GUIDv4", (string)
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note

loop for each settlement debit participant
' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\nadjust ndc: PUT /participants/{name}/limits
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
end

pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
note right moja
**Net debit** participant 
   position ledgers are adjusted
end note

end loop
loop for each settlement credit participant
' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\n adjust ndc: PUT /participants/{name}/limits
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds In)\n POST /participants/{name}/accounts/{id}
end
note left pl
  reason: "Settlement Finanisation"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
end loop
alt if balanceSettlementOption is true 
loop For each participant rebalance Settlement account  
pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
pl->moja: if < actual balance then\n increase balance (funds In)\n POST central-ledger/participants/{name}/accounts/{id}
pl->moja: if > actual balance then\n decrease balance (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Rebalance"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
end 
end

pl- ->el: Response
note right 
  {
    "state": "string",
    "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object
    }]
  }
end note
el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)

@enduml

@startuml settlementProcessAPI
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja

== Close a settlement window ==
bu->ui: User clicks close Settlement Window
ui->el: Close Settlement Window
note left
windows Id
end note
el->moja: Add user information\n POST: /settlementWindows{SettlementWindowId}
el- ->ui: Update UI
== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency or Settlement Model
end note

ui->el: POST: /initiateSettlement 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 }
end note
el->pl: POST: /initiateSettlement 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 "user": "hub operators name" # (string) 
 }
end note
loop For each settlement window
pl->moja: Confirm that the settlement window is closed and wait retry with timeout if not.  \nGET central-settlements/settlementWindows/{id}
end
group determine settlement Model/s 
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlement models using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlement models
end

loop for settlement models
pl->moja: Create settlement \n **POST: central-settlements/settlements** \n{settlementModel, settlementWindowIds[]}
pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: central-settlements/settlements/{id}**
note right moja
**Net credit** participant 
position ledgers are adjusted
end note
end loop
pl- ->el: Return reponse, success HTTP:200
note right
 {
   [
     "SettlementModel":"defered-net" #(string)
     "id":null, # optional (integer)
     "state": "state" # optional (string)
     "errorInformation": { # optional
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" } ] } }
    ]
 }

end note
el- ->ui: Update UI with settlement status

== Generate Settlement Matrix Report ==
bu->ui: Settlement Initiation Report Download
ui->el: Add User
el->report: Settlement Initiation Report Download
report- ->ui: report is downloaded
ui- ->bu:report is downloaded
bu->sbank:
note left
Report is sent to 
**settlement bank** to begin 
the settlement transfers 
between participants
end note

== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: Validate finalisation file
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
group Calculate Adjustments and Warnings
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
end 
pl- -> el: Return finalisation validation results
note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":true, # (boolean) true if none failure error
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}],
    "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
end note
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** PUT 
note left
{
  finalisationId:"GUIDv4", (string)
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** PUT 
note left
{
  "finalisationId":"GUIDv4", (string)
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note

loop for each settlement debit participant
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
end

pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
note right moja
**Net debit** participant 
   position ledgers are adjusted
end note

end loop
loop for each settlement credit participant
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds In)\n POST /participants/{name}/accounts/{id}
end
note left pl
  reason: "Settlement Finanisation"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
end loop
alt if balanceSettlementOption is true 
loop For each participant rebalance Settlement account  
pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
pl->moja: if < actual balance then\n increase balance (funds In)\n POST central-ledger/participants/{name}/accounts/{id}
pl->moja: if > actual balance then\n decrease balance (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Rebalance"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
end 
end

pl- ->el: Response
note right 
  {
    "state": "string",
    "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object
    }]
  }
end note
el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)

@enduml

PlantUML version 1.2020.13(Sat Jun 13 13:26:38 BST 2020)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>