<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5902px" preserveAspectRatio="none" style="width:3572px;height:5902px;" version="1.1" viewBox="0 0 3572 5902" width="3572px" zoomAndPan="magnify"><defs><filter height="300%" id="fi3my06ouzpwz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="209" x="1677" y="34.9141">Settlement Process</text><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2144.5" y="667.4375"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2144.5" y="859.1875"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2144.5" y="2659.375"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2144.5" y="3003.0625"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2144.5" y="3398.75"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="415.25" style="stroke: #000000; stroke-width: 2.0;" width="1405.5" x="2144.5" y="4136.3125"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="475.625" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1638" y="4565.5625"/><rect fill="#FFFFFF" filter="url(#fi3my06ouzpwz)" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1638" y="5055.1875"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="362" x2="362" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="628" x2="628" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="924" x2="924" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1604" x2="1604" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2239.5" x2="2239.5" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2774.5" x2="2774.5" y1="144.375" y2="5801.125"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3178" x2="3178" y1="144.375" y2="5801.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="205" y="139.1016">Business Hub Operator User</text><ellipse cx="362.5" cy="57.1875" fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M362.5,65.1875 L362.5,92.1875 M349.5,73.1875 L375.5,73.1875 M362.5,92.1875 L349.5,107.1875 M362.5,92.1875 L375.5,107.1875 " fill="none" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="205" y="5825.0391">Business Hub Operator User</text><ellipse cx="362.5" cy="5840.3125" fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M362.5,5848.3125 L362.5,5875.3125 M349.5,5856.3125 L375.5,5856.3125 M362.5,5875.3125 L349.5,5890.3125 M362.5,5875.3125 L375.5,5890.3125 " fill="none" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 2.0;"/><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="530" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="537" y="127.1016">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="530" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="537" y="5832.0391">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="838" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="845" y="127.1016">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="838" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="845" y="5832.0391">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1503" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1510" y="127.1016">Experience Layer</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1503" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1510" y="5832.0391">Experience Layer</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2154.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2161.5" y="127.1016">Process Layer</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2154.5" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2161.5" y="5832.0391">Process Layer</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2707.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2714.5" y="127.1016">Report API</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2707.5" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2714.5" y="5832.0391">Report API</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3121" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3128" y="127.1016">Mojaloop</text><rect fill="#F8F8F8" filter="url(#fi3my06ouzpwz)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3121" y="5800.125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3128" y="5832.0391">Mojaloop</text><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3557" x="3" y="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="182.4688" y2="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="185.4688" y2="185.4688"/><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="329" x="1617" y="164.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308" x="1623" y="193.2891">Close a settlement window</text><polygon fill="#383838" points="912.5,244.75,922.5,248.75,912.5,252.75,916.5,248.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="918.5" y1="248.75" y2="248.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="369.5" y="241.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="386.5" y="241.4766">User clicks close Settlement Window</text><polygon fill="#383838" points="1592.5,293.9375,1602.5,297.9375,1592.5,301.9375,1596.5,297.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="924.5" x2="1598.5" y1="297.9375" y2="297.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="931.5" y="290.6641">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="948.5" y="290.6641">Close Settlement Window</text><path d="M775,261.75 L775,301.75 L915,301.75 L915,271.75 L905,261.75 L775,261.75 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M905,261.75 L905,271.75 L915,271.75 L905,261.75 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="119" x="781" y="291.6641">windows Id</text><polygon fill="#383838" points="3166.5,373.3125,3176.5,377.3125,3166.5,381.3125,3170.5,377.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="3172.5" y1="377.3125" y2="377.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1611.5" y="354.9453">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="223" x="1628.5" y="339.8516">Add user information</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="534" x="1635.5" y="370.0391">POST: /settlementWindows{SettlementWindowId}</text><polygon fill="#383838" points="935.5,417.5,925.5,421.5,935.5,425.5,931.5,421.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1603.5" y1="421.5" y2="421.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="941.5" y="414.2266">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="108" x="958.5" y="414.2266">Update UI</text><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3557" x="3" y="457.5938"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="457.5938" y2="457.5938"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="460.5938" y2="460.5938"/><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="228" x="1667.5" y="439.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="1673.5" y="468.4141">Initiate Settlement</text><polygon fill="#383838" points="912.5,539.9688,922.5,543.9688,912.5,547.9688,916.5,543.9688" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="918.5" y1="543.9688" y2="543.9688"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="369.5" y="536.6953">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="521" x="386.5" y="536.6953">Initiate Settlement for these windows &amp; Currency</text><path d="M8,492.6875 L8,562.6875 L354,562.6875 L354,502.6875 L344,492.6875 L8,492.6875 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M344,492.6875 L344,502.6875 L354,502.6875 L344,492.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="325" x="14" y="522.6016">List of Settlement windows Ids</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="210" x="14" y="552.7891">[Optional] Currency</text><polygon fill="#383838" points="1592.5,604.25,1602.5,608.25,1592.5,612.25,1596.5,608.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="924.5" x2="1598.5" y1="608.25" y2="608.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="931.5" y="600.9766">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="223" x="948.5" y="600.9766">Add user information</text><polygon fill="#383838" points="2227.5,648.4375,2237.5,652.4375,2227.5,656.4375,2231.5,652.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="2233.5" y1="652.4375" y2="652.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1611.5" y="645.1641">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="594" x="1628.5" y="645.1641">POST: /initiateSettlement {WindowIds[], currency, user}</text><path d="M2144.5,667.4375 L2652.5,667.4375 L2652.5,689.4375 L2642.5,699.4375 L2144.5,699.4375 L2144.5,667.4375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2144.5" y="667.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="463" x="2159.5" y="693.3516">determine settlement Model/s applicable</text><polygon fill="#383838" points="3166.5,731.8125,3176.5,735.8125,3166.5,739.8125,3170.5,735.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="735.8125" y2="735.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="2246.5" y="728.5391">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="898" x="2263.5" y="728.5391">Load currencies for windows using GET central-settlements/settlementWindows/{id}</text><polygon fill="#383838" points="3166.5,776,3176.5,780,3166.5,784,3170.5,780" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="780" y2="780"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="2246.5" y="772.7266">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2263.5" y="772.7266">Load settlement models using GET central-ledger/settlementModels</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="824.1875" y2="824.1875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="824.1875" y2="837.1875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="837.1875" y2="837.1875"/><polygon fill="#383838" points="2250.5,833.1875,2240.5,837.1875,2250.5,841.1875,2246.5,837.1875" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="816.9141">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="483" x="2276.5" y="816.9141">Determine minimum list of settlement models</text><path d="M2144.5,859.1875 L2241.5,859.1875 L2241.5,881.1875 L2231.5,891.1875 L2144.5,891.1875 L2144.5,859.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2144.5" y="859.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2159.5" y="885.1016">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="2256.5" y="886.1016">[for settlement models]</text><polygon fill="#383838" points="3166.5,999.125,3176.5,1003.125,3166.5,1007.125,3170.5,1003.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="1003.125" y2="1003.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="965.6641">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="190" x="2276.5" y="935.4766">Create settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="965.6641"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="2283.5" y="965.6641">POST: /settlements</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2508.5" y="965.6641"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="451" x="2276.5" y="995.8516">{settlementModel, settlementWindowIds[]}</text><polygon fill="#383838" points="3166.5,1103.6875,3176.5,1107.6875,3166.5,1111.6875,3170.5,1107.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="1107.6875" y2="1107.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="1070.2266">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="422" x="2276.5" y="1040.0391">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="423" x="2283.5" y="1070.2266">state to PS_TRANSFERS_RECORDED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="1100.4141"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="2283.5" y="1100.4141">PUT: /settlements/{id}</text><path d="M3183,1120.6875 L3183,1190.6875 L3515,1190.6875 L3515,1130.6875 L3505,1120.6875 L3183,1120.6875 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3505,1120.6875 L3505,1130.6875 L3515,1130.6875 L3505,1120.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="3189" y="1150.6016">Net credit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3306" y="1150.6016">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3189" y="1180.7891">position ledgers are adjusted</text><polygon fill="#383838" points="1615.5,1239.25,1605.5,1243.25,1615.5,1247.25,1611.5,1243.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1609.5" x2="2238.5" y1="1243.25" y2="1243.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1621.5" y="1235.9766">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="369" x="1651.5" y="1235.9766">Return reponse, success or faliure</text><polygon fill="#383838" points="935.5,1283.4375,925.5,1287.4375,935.5,1291.4375,931.5,1287.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1603.5" y1="1287.4375" y2="1287.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="941.5" y="1280.1641">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="349" x="971.5" y="1280.1641">Update UI with settlement status</text><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3557" x="3" y="1323.5313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="1323.5313" y2="1323.5313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="1326.5313" y2="1326.5313"/><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="415" x="1574" y="1305.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="1580" y="1334.3516">Generate Settlement Matrix Report</text><polygon fill="#383838" points="912.5,1385.8125,922.5,1389.8125,912.5,1393.8125,916.5,1389.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="918.5" y1="1389.8125" y2="1389.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="369.5" y="1382.5391">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="399.5" y="1382.5391">Settlement Initiation Report Download</text><polygon fill="#383838" points="1592.5,1430,1602.5,1434,1592.5,1438,1596.5,1434" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="924.5" x2="1598.5" y1="1434" y2="1434"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="931.5" y="1426.7266">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="100" x="961.5" y="1426.7266">Add User</text><polygon fill="#383838" points="2762.5,1474.1875,2772.5,1478.1875,2762.5,1482.1875,2766.5,1478.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="2768.5" y1="1478.1875" y2="1478.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1611.5" y="1470.9141">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="1641.5" y="1470.9141">Settlement Initiation Report Download</text><polygon fill="#383838" points="935.5,1518.375,925.5,1522.375,935.5,1526.375,931.5,1522.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="2773.5" y1="1522.375" y2="1522.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="941.5" y="1515.1016">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="971.5" y="1515.1016">report is downloaded</text><polygon fill="#383838" points="373.5,1562.5625,363.5,1566.5625,373.5,1570.5625,369.5,1566.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="367.5" x2="923.5" y1="1566.5625" y2="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="379.5" y="1559.2891">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="409.5" y="1559.2891">report is downloaded</text><polygon fill="#383838" points="616,1657.0313,626,1661.0313,616,1665.0313,620,1661.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="622" y1="1661.0313" y2="1661.0313"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="369.5" y="1653.7578">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="406.5" y="1653.7578"/><path d="M49,1579.5625 L49,1709.5625 L353,1709.5625 L353,1589.5625 L343,1579.5625 L49,1579.5625 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M343,1579.5625 L343,1589.5625 L353,1589.5625 L343,1579.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="176" x="55" y="1609.4766">Report is sent to</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="55" y="1639.6641">settlement bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="87" x="244" y="1639.6641">to begin</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="254" x="55" y="1669.8516">the settlement transfers</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="222" x="55" y="1700.0391">between participants</text><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3557" x="3" y="1747.4063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="1747.4063" y2="1747.4063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3560" y1="1750.4063" y2="1750.4063"/><rect fill="#EEEEEE" filter="url(#fi3my06ouzpwz)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="240" x="1661.5" y="1729.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="1667.5" y="1758.2266">Finalise Settlement</text><polygon fill="#383838" points="373.5,1965.625,363.5,1969.625,373.5,1973.625,369.5,1969.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="367.5" x2="627" y1="1969.625" y2="1969.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="379.5" y="1962.3516">21</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="416.5" y="1962.3516"/><path d="M633,1782.5 L633,2124.5 L1236,2124.5 L1236,1792.5 L1226,1782.5 L633,1782.5 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1226,1782.5 L1226,1792.5 L1236,1792.5 L1226,1782.5 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="639" y="1812.4141">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="687" y="1812.4141">Settlement Bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="243" x="881" y="1812.4141">has completed making</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="330" x="639" y="1842.6016">transfers between participants.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="639" y="1872.7891">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="687" y="1872.7891">finalisation report</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="216" x="898" y="1872.7891">that is recieved from</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="575" x="639" y="1902.9766">the Settlement Bank, includes the settlement account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="570" x="639" y="1933.1641">balances after all the transfers have been processed.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="646" y="1963.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="525" x="639" y="1993.5391">It is possible that these account balances are not</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="431" x="639" y="2023.7266">as expected. This would indicate that an</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="1077" y="2023.7266">additional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1199" y="2023.7266"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="639" y="2053.9141">funds in / funds out</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="318" x="873" y="2053.9141">has occured in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="501" x="639" y="2084.1016">accounts that has not yet been captured in the</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="314" x="639" y="2114.2891">Mojaloop Settlement ledgers.</text><polygon fill="#383838" points="912.5,2165.75,922.5,2169.75,912.5,2173.75,916.5,2169.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="918.5" y1="2169.75" y2="2169.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="369.5" y="2162.4766">22</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="399.5" y="2162.4766">Validate finalisation file</text><polygon fill="#383838" points="1592.5,2209.9375,1602.5,2213.9375,1592.5,2217.9375,1596.5,2213.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="924.5" x2="1598.5" y1="2213.9375" y2="2213.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="931.5" y="2206.6641">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="961.5" y="2206.6641">Validate finalisation file</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="1646.5" y1="2437.75" y2="2437.75"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1646.5" x2="1646.5" y1="2437.75" y2="2450.75"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1605.5" x2="1646.5" y1="2450.75" y2="2450.75"/><polygon fill="#383838" points="1615.5,2446.75,1605.5,2450.75,1615.5,2454.75,1611.5,2450.75" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1611.5" y="2415.3828">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="267" x="1641.5" y="2400.2891">Fatal: Validate file format</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="280" x="1648.5" y="2430.4766">Load file into JSON object</text><path d="M1285,2226.9375 L1285,2598.9375 L1595,2598.9375 L1595,2236.9375 L1585,2226.9375 L1285,2226.9375 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1585,2226.9375 L1585,2236.9375 L1595,2236.9375 L1585,2226.9375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1291" y="2256.8516">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="1305" y="2287.0391">finalisationReference: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="171" x="1305" y="2317.2266">settlementId : x,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="1305" y="2347.4141">participants : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="175" x="1319" y="2377.6016">{ dfspIdentifier: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="119" x="1333" y="2407.7891">dfspDbId: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="240" x="1333" y="2437.9766">settlementAccountId: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="106" x="1333" y="2468.1641">balance: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="222" x="1333" y="2498.3516">settlementTransfer: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="100" x="1333" y="2528.5391">currency:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="57" x="1319" y="2558.7266">}, ... ]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1291" y="2588.9141">}</text><polygon fill="#383838" points="2227.5,2640.375,2237.5,2644.375,2227.5,2648.375,2231.5,2644.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="2233.5" y1="2644.375" y2="2644.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1611.5" y="2637.1016">25</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1641.5" y="2637.1016">Validate finalisation</text><path d="M2144.5,2659.375 L2421.5,2659.375 L2421.5,2681.375 L2411.5,2691.375 L2144.5,2691.375 L2144.5,2659.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2144.5" y="2659.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="232" x="2159.5" y="2685.2891">load settlement data</text><polygon fill="#383838" points="3166.5,2753.9375,3176.5,2757.9375,3166.5,2761.9375,3170.5,2757.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="2757.9375" y2="2757.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="2735.5703">26</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="284" x="2276.5" y="2720.4766">Get settlement information</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="461" x="2276.5" y="2750.6641">GET central-settlements/settlements/{id}</text><polygon fill="#383838" points="3166.5,2828.3125,3176.5,2832.3125,3166.5,2836.3125,3170.5,2832.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="2832.3125" y2="2832.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="2809.9453">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="202" x="2276.5" y="2794.8516">Get all participants</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="2825.0391"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="358" x="2283.5" y="2825.0391">GET central-ledger/participants</text><polygon fill="#383838" points="3166.5,2902.6875,3176.5,2906.6875,3166.5,2910.6875,3170.5,2906.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="2906.6875" y2="2906.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="2884.3203">28</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="264" x="2276.5" y="2869.2266">Get all participants limits</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="2899.4141"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="428" x="2283.5" y="2899.4141">GET central-ledger/participants/limits</text><polygon fill="#383838" points="3166.5,2977.0625,3176.5,2981.0625,3166.5,2985.0625,3170.5,2981.0625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="2981.0625" y2="2981.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="2958.6953">29</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="439" x="2276.5" y="2943.6016">For each participant get account balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="2973.7891"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2283.5" y="2973.7891">GET central-ledger/participants/{name}/accounts</text><path d="M2144.5,3003.0625 L2401.5,3003.0625 L2401.5,3025.0625 L2391.5,3035.0625 L2144.5,3035.0625 L2144.5,3003.0625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2144.5" y="3003.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="2159.5" y="3028.9766">Process validation</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3131.8125" y2="3131.8125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3131.8125" y2="3144.8125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3144.8125" y2="3144.8125"/><polygon fill="#383838" points="2250.5,3140.8125,2240.5,3144.8125,2250.5,3148.8125,2246.5,3144.8125" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3094.3516">30</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="389" x="2276.5" y="3064.1641">Fatal: Validate Participants and their</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="319" x="2283.5" y="3094.3516">accounts ids are valid, match,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="491" x="2276.5" y="3124.5391">and are the correct type, and correct currency</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3189" y2="3189"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3189" y2="3202"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3202" y2="3202"/><polygon fill="#383838" points="2250.5,3198,2240.5,3202,2250.5,3206,2246.5,3202" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3181.7266">31</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="446" x="2276.5" y="3181.7266">Fatal: Validate Settlment Id non-matching</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3276.375" y2="3276.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3276.375" y2="3289.375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3289.375" y2="3289.375"/><polygon fill="#383838" points="2250.5,3285.375,2240.5,3289.375,2250.5,3293.375,2246.5,3289.375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3254.0078">32</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2276.5" y="3238.9141">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="212" x="2276.5" y="3269.1016">transfer sum is zero</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3363.75" y2="3363.75"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3363.75" y2="3376.75"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3376.75" y2="3376.75"/><polygon fill="#383838" points="2250.5,3372.75,2240.5,3376.75,2250.5,3380.75,2246.5,3376.75" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3341.3828">33</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2276.5" y="3326.2891">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="339" x="2276.5" y="3356.4766">matches net settlement amount</text><path d="M2144.5,3398.75 L2614.5,3398.75 L2614.5,3420.75 L2604.5,3430.75 L2144.5,3430.75 L2144.5,3398.75 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2144.5" y="3398.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="425" x="2159.5" y="3424.6641">Calculate Adjustments and Warnings</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3527.5" y2="3527.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3527.5" y2="3540.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3540.5" y2="3540.5"/><polygon fill="#383838" points="2250.5,3536.5,2240.5,3540.5,2250.5,3544.5,2246.5,3540.5" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3490.0391">34</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2276.5" y="3459.8516">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="213" x="2276.5" y="3490.0391">balance is expected</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="2283.5" y="3520.2266">Return warnings if there are discrepencies</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="2281.5" y1="3614.875" y2="3614.875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2281.5" x2="2281.5" y1="3614.875" y2="3627.875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2240.5" x2="2281.5" y1="3627.875" y2="3627.875"/><polygon fill="#383838" points="2250.5,3623.875,2240.5,3627.875,2250.5,3631.875,2246.5,3627.875" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="3592.5078">35</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2276.5" y="3577.4141">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="2276.5" y="3607.6016">balance is zero or positive</text><polygon fill="#383838" points="1615.5,3755.5313,1605.5,3759.5313,1615.5,3763.5313,1611.5,3759.5313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1609.5" x2="2238.5" y1="3759.5313" y2="3759.5313"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1621.5" y="3752.2578">36</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="1651.5" y="3752.2578">Return finalisation validation results</text><path d="M2244,3647.875 L2244,3838.875 L2781,3838.875 L2781,3657.875 L2771,3647.875 L2244,3647.875 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2771,3647.875 L2771,3657.875 L2781,3657.875 L2771,3647.875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2250" y="3677.7891">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="187" x="2264" y="3707.9766">finalisationGuid: ,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="2264" y="3738.1641">valid :true,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="404" x="2264" y="3768.3516">errors: [{errorType: , errorMessage: }],</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="502" x="2264" y="3798.5391">warnings: [{warningType: , warningMessage: }]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2250" y="3828.7266">}</text><polygon fill="#383838" points="935.5,3880.1875,925.5,3884.1875,935.5,3888.1875,931.5,3884.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1603.5" y1="3884.1875" y2="3884.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="941.5" y="3876.9141">37</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="328" x="971.5" y="3876.9141">Show validation results to user</text><polygon fill="#383838" points="373.5,3924.375,363.5,3928.375,373.5,3932.375,369.5,3928.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="367.5" x2="923.5" y1="3928.375" y2="3928.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="379.5" y="3921.1016">38</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="416.5" y="3921.1016"/><polygon fill="#383838" points="912.5,3968.5625,922.5,3972.5625,912.5,3976.5625,916.5,3972.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="362.5" x2="918.5" y1="3972.5625" y2="3972.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="369.5" y="3965.2891">39</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="446" x="399.5" y="3965.2891">User confirms proceeding with finalisation</text><polygon fill="#383838" points="1592.5,4073.125,1602.5,4077.125,1592.5,4081.125,1596.5,4077.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="924.5" x2="1598.5" y1="4077.125" y2="4077.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="931.5" y="4039.6641">40</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="961.5" y="4009.4766">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1202.5" y="4009.4766"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="961.5" y="4039.6641">finalisationGuid:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1159.5" y="4039.6641"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="961.5" y="4069.8516">options:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="524" x="1063.5" y="4069.8516">{ balanceSettlement, ndcIncrease, ndcDecrease}</text><polygon fill="#383838" points="2227.5,4117.3125,2237.5,4121.3125,2227.5,4125.3125,2231.5,4121.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1604.5" x2="2233.5" y1="4121.3125" y2="4121.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1611.5" y="4114.0391">41</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1648.5" y="4114.0391"/><path d="M2144.5,4136.3125 L2241.5,4136.3125 L2241.5,4158.3125 L2231.5,4168.3125 L2144.5,4168.3125 L2144.5,4136.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="415.25" style="stroke: #000000; stroke-width: 2.0;" width="1405.5" x="2144.5" y="4136.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2159.5" y="4162.2266">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="430" x="2256.5" y="4163.2266">[for each settlement debit participant]</text><polygon fill="#383838" points="3166.5,4246.0625,3176.5,4250.0625,3166.5,4254.0625,3170.5,4250.0625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="4250.0625" y2="4250.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4227.6953">42</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="721" x="2276.5" y="4212.6016">[Remove if Liquidity adjustment includes settlement account check]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="457" x="2276.5" y="4242.7891">adjust ndc: PUT /participants/{name}/limits</text><polygon fill="#383838" points="3166.5,4350.625,3176.5,4354.625,3166.5,4358.625,3170.5,4354.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="4354.625" y2="4354.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4317.1641">43</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="655" x="2276.5" y="4286.9766">Adjust settlment account according to settlement (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2283.5" y="4317.1641">POST /participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2276.5" y="4347.3516">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><polygon fill="#383838" points="3166.5,4455.1875,3176.5,4459.1875,3166.5,4463.1875,3170.5,4459.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="4459.1875" y2="4459.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4421.7266">44</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2276.5" y="4391.5391">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="585" x="2276.5" y="4421.7266">PUT /settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2283.5" y="4451.9141">PUT /settlements/{sid}/participants/{pid}</text><path d="M3183,4472.1875 L3183,4542.1875 L3536,4542.1875 L3536,4482.1875 L3526,4472.1875 L3183,4472.1875 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3526,4472.1875 L3526,4482.1875 L3536,4482.1875 L3526,4472.1875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="3189" y="4502.1016">Net debit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3299" y="4502.1016">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3210" y="4532.2891">position ledgers are adjusted</text><path d="M1638,4565.5625 L1735,4565.5625 L1735,4587.5625 L1725,4597.5625 L1638,4597.5625 L1638,4565.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="475.625" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1638" y="4565.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1653" y="4591.4766">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1750" y="4592.4766">[for each settlement credit participant]</text><polygon fill="#383838" points="3166.5,4675.3125,3176.5,4679.3125,3166.5,4683.3125,3170.5,4679.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="4679.3125" y2="4679.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4656.9453">45</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="721" x="2276.5" y="4641.8516">[Remove if Liquidity adjustment includes settlement account check]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="457" x="2283.5" y="4672.0391">adjust ndc: PUT /participants/{name}/limits</text><polygon fill="#383838" points="3166.5,4779.875,3176.5,4783.875,3166.5,4787.875,3170.5,4783.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="4783.875" y2="4783.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4746.4141">46</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="655" x="2276.5" y="4716.2266">Adjust settlment account according to settlement (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2283.5" y="4746.4141">POST /participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2276.5" y="4776.6016">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><path d="M1648,4796.875 L1648,4926.875 L2230,4926.875 L2230,4806.875 L2220,4796.875 L1648,4796.875 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2220,4796.875 L2220,4806.875 L2230,4806.875 L2220,4796.875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="358" x="1654" y="4826.7891">reason: "Settlement Finanisation"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1654" y="4856.9766">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1668" y="4887.1641">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1682" y="4917.3516">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3166.5,5029.1875,3176.5,5033.1875,3166.5,5037.1875,3170.5,5033.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="5033.1875" y2="5033.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="4995.7266">47</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2276.5" y="4965.5391">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="585" x="2276.5" y="4995.7266">PUT /settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2283.5" y="5025.9141">PUT /settlements/{sid}/participants/{pid}</text><path d="M1638,5055.1875 L1735,5055.1875 L1735,5077.1875 L1725,5087.1875 L1638,5087.1875 L1638,5055.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1638" y="5055.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1653" y="5081.1016">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="592" x="1750" y="5082.1016">[For each participant rebalance Settlement account]</text><polygon fill="#383838" points="3166.5,5164.9375,3176.5,5168.9375,3166.5,5172.9375,3170.5,5168.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="5168.9375" y2="5168.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="5146.5703">48</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="196" x="2276.5" y="5131.4766">Get latest balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="5161.6641"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2283.5" y="5161.6641">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="3166.5,5269.5,3176.5,5273.5,3166.5,5277.5,3170.5,5273.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="5273.5" y2="5273.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="5236.0391">49</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2276.5" y="5205.8516">if &lt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="293" x="2283.5" y="5236.0391">increase balance (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2283.5" y="5266.2266">POST /participants/{name}/accounts/{id}</text><polygon fill="#383838" points="3166.5,5404.25,3176.5,5408.25,3166.5,5412.25,3170.5,5408.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="5408.25" y2="5408.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="5355.6953">50</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2276.5" y="5310.4141">if &gt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="321" x="2283.5" y="5340.6016">decrease balance (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2283.5" y="5370.7891">POST /participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2276.5" y="5400.9766">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><path d="M1648,5421.25 L1648,5551.25 L2230,5551.25 L2230,5431.25 L2220,5421.25 L1648,5421.25 " fill="#ECECEC" filter="url(#fi3my06ouzpwz)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2220,5421.25 L2220,5431.25 L2230,5431.25 L2220,5421.25 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="343" x="1654" y="5451.1641">reason: "Settlement Rebalance"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1654" y="5481.3516">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1668" y="5511.5391">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1682" y="5541.7266">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3166.5,5623.375,3176.5,5627.375,3166.5,5631.375,3170.5,5627.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2239.5" x2="3172.5" y1="5627.375" y2="5627.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2246.5" y="5605.0078">51</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="256" x="2276.5" y="5589.9141">Confirm correct balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2283.5" y="5620.1016"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2283.5" y="5620.1016">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="1615.5,5674.5625,1605.5,5678.5625,1615.5,5682.5625,1611.5,5678.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1609.5" x2="2238.5" y1="5678.5625" y2="5678.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1621.5" y="5671.2891">52</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="1651.5" y="5671.2891">Update settlement Status or display errors</text><polygon fill="#383838" points="935.5,5779.125,925.5,5783.125,935.5,5787.125,931.5,5783.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1603.5" y1="5783.125" y2="5783.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="941.5" y="5745.6641">53</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="971.5" y="5715.4766">Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="86" x="978.5" y="5745.6641">Process</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="117" x="978.5" y="5775.8516">Completed</text><!--MD5=[a92a99cbfcfdce5bffc6eadaa37b83fb]
@startuml settlementProcessAPI
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja

== Close a settlement window ==
bu->ui: User clicks close Settlement Window
ui->el: Close Settlement Window
note left
windows Id
end note
el->moja: Add user information\n POST: /settlementWindows{SettlementWindowId}
el- ->ui: Update UI
== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency
end note

ui->el: Add user information
el->pl: POST: /initiateSettlement {WindowIds[], currency, user}

group determine settlement Model/s applicable
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlement models using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlement models
end

loop for settlement models
pl->moja: Create settlement \n **POST: /settlements** \n{settlementModel, settlementWindowIds[]}
pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: /settlements/{id}**
note right moja
**Net credit** participant 
position ledgers are adjusted
end note
end loop
pl- ->el: Return reponse, success or faliure
el- ->ui: Update UI with settlement status

== Generate Settlement Matrix Report ==
bu->ui: Settlement Initiation Report Download
ui->el: Add User
el->report: Settlement Initiation Report Download
report- ->ui: report is downloaded
ui- ->bu:report is downloaded
bu->sbank:
note left
Report is sent to 
**settlement bank** to begin 
the settlement transfers 
between participants
end note

== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: Validate finalisation file
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  finalisationReference: ,
  settlementId : x,
  participants : [
    { dfspIdentifier: , 
      dfspDbId: , 
      settlementAccountId: , 
      balance: , 
      settlementTransfer: , 
      currency: 
    }, ... ]
}
end note

el -> pl: **Validate finalisation**
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlment Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
group Calculate Adjustments and Warnings
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
end 
pl- -> el: Return finalisation validation results
note right
  {
    finalisationGuid: ,
    valid :true,
    errors: [{errorType: , errorMessage: }],
    warnings: [{warningType: , warningMessage: }]
  }
end note
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** \n**finalisationGuid:** \n**options:** { balanceSettlement, ndcIncrease, ndcDecrease}
el -> pl: 

loop for each settlement debit participant
pl->moja: [Remove if Liquidity adjustment includes settlement account check]\nadjust ndc: PUT /participants/{name}/limits
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST /participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}

pl->moja: Advance state to Settled\nPUT /settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
note right moja
**Net debit** participant 
   position ledgers are adjusted
end note

end loop
loop for each settlement credit participant
pl->moja: [Remove if Liquidity adjustment includes settlement account check]\n adjust ndc: PUT /participants/{name}/limits
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST /participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Finanisation"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Advance state to Settled\nPUT /settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
end loop

loop For each participant rebalance Settlement account  
pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
pl->moja: if < actual balance then\n increase balance (funds In)\n POST /participants/{name}/accounts/{id}
pl->moja: if > actual balance then\n decrease balance (funds Out)\n POST /participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Rebalance"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
end 

pl- ->el: Update settlement Status or display errors
el- ->ui: Settlement \n Process \n Completed

@enduml

PlantUML version 1.2020.13(Sat Jun 13 13:26:38 BST 2020)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>