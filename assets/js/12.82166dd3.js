(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{414:function(t,e,a){t.exports=a.p+"assets/img/RestReportingArchitecture.drawio.5cab96b0.png"},439:function(t,e,a){"use strict";a.r(e);var s=a(23),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"report-developer-guide"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#report-developer-guide"}},[t._v("#")]),t._v(" Report Developer Guide")]),t._v(" "),s("p",[t._v("This is a developer guide to building and deploying reports for the reporting REST service that is part of the deployment at the Hub.")]),t._v(" "),s("h2",{attrs:{id:"architecture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[t._v("#")]),t._v(" Architecture")]),t._v(" "),s("p",[s("img",{attrs:{src:a(414),alt:"Architecture diagram of reporting service operator"}}),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/mojaloop/reporting",target:"_blank",rel:"noopener noreferrer"}},[t._v("Here"),s("OutboundLink")],1),t._v(" is the repository of the reporting service operator."),s("br"),t._v("\nThe reporting service operator has been designed to be accessed by either a hub operator, or a DFSP operator."),s("br"),t._v("\nAccess to the report is controlled through the RBAC integration that is part of the business operations framework. Ory Oathkeeper protects the reporting API end point, and Keto is checked by the reporting service operator for finer grained report specific authorisation."),s("br"),t._v("\nThe report data is queried from the SQL Reporting database which is at the moment a one way sync of the central ledger database."),s("br"),t._v("\nEach report is installed on the system as a kubernetes custom resource which is a .yaml file of a particular format that is applied to the kubernetes cluster. "),s("a",{attrs:{href:"https://github.com/mojaloop/reporting-k8s-templates",target:"_blank",rel:"noopener noreferrer"}},[t._v("Here"),s("OutboundLink")],1),t._v(" is the repository of the open sourced report templates. The custom resource definition for a report is defined "),s("a",{attrs:{href:"https://github.com/mojaloop/reporting-k8s-templates/blob/master/crds/reporting-crd.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(" which describes the format of the custom resource.")]),t._v(" "),s("h2",{attrs:{id:"rbac"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rbac"}},[t._v("#")]),t._v(" RBAC")]),t._v(" "),s("p",[t._v("Access to the reports are controlled through the RBAC when the service is deployed through the standard IaC configuration."),s("br"),t._v("\nThis means that in order to access a report, a user will need to have the correct authorisation assigned. This is acheived through the assignement of roles to the user, and the assignment of participant access.")]),t._v(" "),s("p",[t._v("The first authorisation check is made by Ory Oathkeeper which has a rule that links the")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("reportingApi\n")])])]),s("p",[t._v("perission to assess to the reporting service API endpoint.")]),t._v(" "),s("p",[t._v("The next authorisation check is made by the reporting service operator. Permission to access the particulat report is checked. The permission that is checked is defined in the custom resource. This permission is optional and will otherwise use the name (metadata) of the report as defined in the customer resource.")]),t._v(" "),s("h3",{attrs:{id:"requiring-dfsp-permission"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requiring-dfsp-permission"}},[t._v("#")]),t._v(" Requiring DFSP permission")]),t._v(" "),s("p",[t._v("If the report is intended for a particular participant of DFSP, then it is imporant to use the ‘dfspId’ parameter. This paramter then first check for participant authoriasation before executing and producing the report."),s("br"),t._v("\nI.e.")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dfspId\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("h3",{attrs:{id:"running-the-report"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#running-the-report"}},[t._v("#")]),t._v(" Running the report")]),t._v(" "),s("p",[t._v("First you will need to login. The easiest way of doing this is to login to the Financial Portal. This create the authorisation and authentication cookie tokens which the report then uses."),s("br"),t._v("\nHere is an example of accessing the report directly after loggin.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://bofportal.YourEnvironment.YourDomain.com/proxy/reports/MyReportPath?ReportParamter=25\n")])])]),s("h3",{attrs:{id:"report-output-formats"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#report-output-formats"}},[t._v("#")]),t._v(" report output formats")]),t._v(" "),s("p",[t._v("The report supports multiple output formats. To switch between these use the format paramter in the Rest query.")]),t._v(" "),s("ol",[s("li",[t._v("Excel file")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("&format=xlsx\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Comma seperated values")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("&format=csv\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("JSON class format")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("&format=json\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("HTML browser format (this is the default format output)")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("&format=html\n")])])]),s("h2",{attrs:{id:"kubernetes-custom-resource"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-custom-resource"}},[t._v("#")]),t._v(" Kubernetes Custom Resource")]),t._v(" "),s("p",[t._v("All aspects of a report are controlled through the mojaloopreport custome resource file. The definition of that file looks as follows.")]),t._v(" "),s("h3",{attrs:{id:"custom-resource-definition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-resource-definition"}},[t._v("#")]),t._v(" Custom Resource Definition")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mojaloopreports.mojaloop.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mojaloop.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mojaloopreports\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mojaloopreport\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mlreport\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MojaloopReport\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("listKind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MojaloopReportList\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MojaloopReport is the Schema for MojaloopReport API\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n                APIVersion defines the versioned schema of this representation\n                of an object. Servers should convert recognized schemas to the\n                latest internal value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and may reject unrecognized values. More\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//git.k8s.io/community/contributors/devel/sig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("architecture/api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conventions.md"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#resources")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n                Kind is a string value representing the REST resource this\n                object represents. Servers may infer this from the endpoint the\n                client submits requests to. Cannot be updated. In CamelCase.\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("More info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//git.k8s.io/community/contributors/devel/sig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("architecture/api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conventions.md"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#types-kinds")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MojaloopReport.spec describes the desired state of my resource\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" endpoint\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" queries\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" template\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("permission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Permission to be needed to access this report. This is optional. If unspecified"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" the name of the resource will be considered as permission.\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Reporting endpoint\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" path\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Report URL path\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Report query params\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Query param\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" name\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Query param name\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Make query param required\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" boolean\n                          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Default query param value\n                            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The list of queries used in ejs reporting template\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" permission ID.\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" name\n                      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" query\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Variable name that the query result will be assigned to\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SQL query\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ejs reporting template\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The status of this MojaloopReport resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" set by the operator.\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The state of the report.\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("additionalPrinterColumns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" endpoint\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Reporting endpoint\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jsonPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .spec.endpoint.path\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("conversion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n")])])]),s("p",[t._v("Example of reports that conform to this custom resource can be found "),s("a",{attrs:{href:"https://github.com/mojaloop/reporting-k8s-templates/tree/master/templates",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v("."),s("br"),t._v("\nPlease note that these Yaml files also contain "),s("strong",[t._v("helm directives")]),t._v(" in these files denoted by the double curly brackets.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("{{ some helm directive / function }}\n")])])]),s("p",[t._v("If you intend to manually apply these files to kubernetes, these will need to be removed or replaced.")]),t._v(" "),s("h3",{attrs:{id:"kubectl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubectl"}},[t._v("#")]),t._v(" Kubectl")]),t._v(" "),s("p",[t._v("You can use the following command to apply a report custom resource to a kubernetes instance.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl apply -f resources/examples/participant_list.yaml\n")])])]),s("p",[t._v("Let’s cover some of the details in the custome resource.")]),t._v(" "),s("h3",{attrs:{id:"control-how-the-report-is-called"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#control-how-the-report-is-called"}},[t._v("#")]),t._v(" Control how the report is called")]),t._v(" "),s("p",[t._v("The first part of the spec: of the report defines how the report is called."),s("br"),t._v("\nI.e.")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("permission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" report"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dfsp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("settlement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("detail\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /dfspSettlementDetail\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" settlementId\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fspid\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("permission")]),t._v(" this is where the RBAC permission tag for this report is defined")]),t._v(" "),s("li",[s("strong",[t._v("path")]),t._v(" this is the endpoint path for this report")]),t._v(" "),s("li",[s("strong",[t._v("params")]),t._v(" here the paramters for the report are defined and specified if they are required paramters or not.")])]),t._v(" "),s("h3",{attrs:{id:"control-where-the-report-gets-it-data-from"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#control-where-the-report-gets-it-data-from"}},[t._v("#")]),t._v(" Control where the report gets it data from")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dfspInfo\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        SELECT participantId, name FROM participant WHERE name = :fspid AND name != 'Hub'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" report\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        SELECT\n                pCPayer.participantId as payerFspid,")]),t._v("\n")])])]),s("p",[t._v("In the queries section, any number of queries can be defined that are run against the reporting database and loaded into named json classes."),s("br"),t._v("\nInput parameters can be used in the queries by using a colon in front of the parameter name. e.g.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(":paramname\n")])])]),s("h3",{attrs:{id:"control-how-the-reports-look-like"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#control-how-the-reports-look-like"}},[t._v("#")]),t._v(" Control how the reports look like")]),t._v(" "),s("p",[t._v("The template part of the custom resource file contains an EJS script that is use to produce the report."),s("br"),t._v("\nThese scripts look like html with styling, but contain code within script blocks")]),t._v(" "),s("div",{staticClass:"language-ejs extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ejs"}},[s("code",[s("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v(" ejs script ")]),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n")])])]),s("p",[t._v("The EJS scripts are quite versitile and can be used to change a name text, or  define formatting functions, or loops that loop through data.")]),t._v(" "),s("h2",{attrs:{id:"building-your-development-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#building-your-development-environment"}},[t._v("#")]),t._v(" Building your development environment")]),t._v(" "),s("p",[s("em",[t._v("(Installation this service locally to aid development.)")]),s("br"),t._v("\nCurrently the only way to validate the report design, is to apply the report to the kubernetes that the reporting service is running in. The reporting service will initially validate the report, and then enable the endpoint. The report can be run and checked to see if it meets it’s requirements.")]),t._v(" "),s("p",[t._v("This document provides instructions for deploying this service locally, so that a developer can try out their designs before installing the report in a an environment"),s("br"),t._v("\nSince the reporting service follows K8S operator pattern, we need to deploy a mini Kubernetes cluster on our machine and deploy the reporting service along with some dependent services.")]),t._v(" "),s("h3",{attrs:{id:"pre-requisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pre-requisites"}},[t._v("#")]),t._v(" Pre-requisites")]),t._v(" "),s("ul",[s("li",[t._v("Please make sure that you have the following softwares installed\n"),s("ul",[s("li",[t._v("git")]),t._v(" "),s("li",[t._v("docker")]),t._v(" "),s("li",[t._v("minikube")]),t._v(" "),s("li",[t._v("kubectl")]),t._v(" "),s("li",[t._v("helm")]),t._v(" "),s("li",[t._v("mysql-client")])])])]),t._v(" "),s("h3",{attrs:{id:"install-k8s"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-k8s"}},[t._v("#")]),t._v(" Install K8S")]),t._v(" "),s("ul",[s("li",[t._v("Start minikube K8S cluster with the following command"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("minikube start --driver=docker --kubernetes-version=v1.21.5\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"clone-the-repository"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#clone-the-repository"}},[t._v("#")]),t._v(" Clone the repository")]),t._v(" "),s("ul",[s("li",[t._v("Download the repository"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://github.com/mojaloop/reporting.git\ncd reporting\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"deploy-helm-chart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-helm-chart"}},[t._v("#")]),t._v(" Deploy helm chart")]),t._v(" "),s("ul",[s("li",[t._v("Install helm chart using the following commands"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("helm dep up ./resources/test-integration/\nhelm install test1 ./resources/test-integration/ --set reporting-legacy-api.image.tag=v11.0.0\n")])])])]),t._v(" "),s("li",[t._v("Wait for all the services to be up"),s("br"),t._v("\nYou can monitor the pods health or use the following commands to wait for the services"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl -n default rollout status deployment test1-reporting-legacy-api\nkubectl -n default rollout status statefulset mysql\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"restore-mysql-database-backup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#restore-mysql-database-backup"}},[t._v("#")]),t._v(" Restore mysql database backup")]),t._v(" "),s("ul",[s("li",[t._v("Port forward the mysql service"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl port-forward -n default service/mysql 3306:3306\n")])])])]),t._v(" "),s("li",[t._v("Insert sample data into database. You can change the database name and filename in the following command as per your need."),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mysql -h127.0.0.1 -P3306 -uuser -ppassword default < ./resources/examples/participants_db_dump.sql\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"load-reporting-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#load-reporting-template"}},[t._v("#")]),t._v(" Load reporting template")]),t._v(" "),s("ul",[s("li",[t._v("Adding the custom resource using the following command"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl apply -f resources/examples/participant_list.yaml\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"get-the-report"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-the-report"}},[t._v("#")]),t._v(" Get the report")]),t._v(" "),s("ul",[s("li",[t._v("Port forward the reporting service"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl port-forward -n default service/test1-reporting-legacy-api 8080:80\n")])])])]),t._v(" "),s("li",[t._v("Get the report by opening the following URL in browser"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://localhost/participant-list\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"cleanup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[t._v("#")]),t._v(" Cleanup")]),t._v(" "),s("ul",[s("li",[t._v("Cleanup"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("kubectl delete -f resources/examples/participant_list.yaml\nhelm uninstall test1\nminikube stop\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"deploying-to-a-production-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploying-to-a-production-environment"}},[t._v("#")]),t._v(" Deploying to a production environment")]),t._v(" "),s("p",[t._v("There are multiple ways that a report custom resource can be deployed into an environment. The method that has been chosen and built into the IaC offering involves the use of a helm chart. (This aligns well with other Mojaloop components.)")]),t._v(" "),s("p",[t._v("The IaC enables both a public and a private deployment of reports. The process is identical except for the repository being private and residing within organisation’s source control."),s("br"),t._v("\nAt a high level the process looks as follows:")]),t._v(" "),s("ol",[s("li",[t._v("Branch and commit changes to the repository where the report is deployed from.")]),t._v(" "),s("li",[t._v("Create a pull request and merge the changes into the master branch of the repository.")]),t._v(" "),s("li",[t._v("Create a new release on the repository. (Depending on configuration this typically kicks off a CICD mechanism that builds and publishes the helm package.)")]),t._v(" "),s("li",[t._v("Update the IaC to depoly the new helm release version for the reports.")]),t._v(" "),s("li",[t._v("Run the appropriate pipeline to perform the deployment.")])])])}),[],!1,null,null,null);e.default=r.exports}}]);